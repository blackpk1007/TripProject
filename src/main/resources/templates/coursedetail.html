<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ì½”ìŠ¤ ìƒì„¸</title>
<link rel="stylesheet" href="/resources/css/reset.css"	type="text/css">
<link
	href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400&display=swap"
	rel="stylesheet">
	<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.1/css/swiper.min.css">
<style type="text/css">
/* íŒì—… ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
.place_popup-container {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	background-color: rgba(0, 0, 0, 0.5);
	display: flex;
	align-items: center;
	justify-content: center;
	z-index: 9999;
}

/* íŒì—… ë‚´ë¶€ ìŠ¤íƒ€ì¼ */
.place_popup {
	position: relative;
	background-color: #fff;
	padding: 20px;
	max-width: 800px;
	max-height: 95%;
	width: 800px;
	border-radius: 5px;
	box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
	border: 4px solid #B8E9FF; /* í…Œë‘ë¦¬ ì¶”ê°€ */
	box-sizing: border-box; /* í…Œë‘ë¦¬ë¥¼ ìš”ì†Œ í¬ê¸°ì— í¬í•¨ */
	overflow-y: auto;
}

.place_popup img {
	width: 100%; /* ì´ë¯¸ì§€ë¥¼ ê½‰ ì°¨ê²Œ í‘œì‹œ */
	height: auto;
	margin: 0 auto;
	display: block;
}

.place_popup h1 {
	font-size: 24px;
	margin-bottom: 10px;
}

.place_popup p {
	margin-bottom: 10px;
	font-size:14px;
}

.place_popup-close {
	position: absolute;
	top: 10px;
	right: 10px;
	cursor: pointer;
	font-size: 20px;
	color: #888;
}
.place_popup-close-listEmpty{
	position: absolute;
	top: 185px;
    right: 570px;
	cursor: pointer;
	font-size: 20px;
	color: #888;
	
}

.place_popup img {
	max-width: 600px;
	max-height: 300px;
	width: auto;
	height: auto;
	margin: 0 auto;
	display: block;
}

.place_popup p.recommend {
	display: flex;
	align-items: center;
}

.place_popup p.recommend img {
	width: 16px;
	height: 16px;
	margin-right: 5px;
}

.place_popup p.recommend span {
	font-size: 14px;
}
.header {
	width: 90vw;
	border-bottom: 1px solid #EEEEEE;
	margin-left: auto;
	margin-right: auto;
	margin-bottom: 5vh;
	font-size: 1.8rem;
	display:grid;
	grid-template-rows: 13vh;
	font-weight:500;
	text-shadow:  -0.1px 0.1px 0 #000, 0.1px 0.1px 0 #000;
}

.header-category {
	display: flex;
	justify-content: center;
	align-items: center;
}
.header-left{
	flex:2;
	display: flex;
	justify-content: center;
	align-items: center;
}
.header-center{
	flex:3;
	display: flex;
	justify-content: center;
	align-items: center;
}
.header-right{
	flex:2;
	display: flex;
	justify-content: center;
	align-items: center;
}

#logimg {
	width: 280px;
	height: 160px;
	padding-right:1vw;
}

#label-left-plan {
	margin: auto;
}

#label-left-course {
	margin: auto;
}

#label-left-community {
	margin: auto;
}

#label-left-chat {
	margin: auto;
}

#label-right-login {
	padding-left: 1vw;
	padding-right: 1vw;
	margin-left: 3vw;
}

#label-right-register {
	margin-left: 3vw;
}
.body{
	display: flex;
	width: 98vw;
	height: 100%;
	flex-direction: column;
	position:relative;

	justify-content: center;
	align-items: center;
	
}

.map{
	display:flex;
	position:relative;
	justify-content: center;
	margin:1rem;
}
#map_div{
	text-align:center;
}
/* ê²½ë¡œ ë²„íŠ¼ ë¶€ë¶„ */
.coursebtn{
	position: relative;
	
}

/* day 1  í…ìŠ¤íŠ¸ ë¶€ë¶„ */
.mymain_text{
	width:20vw;
	font-size:1.8rem;
	margin:1rem;
	margin-bottom:0;
	margin-top: 6vh;
	position:relative;
	display:flex;
	justify-content:center;
	right: 16vw;
	height: 6vh;
	margin-left: 1.5vw;
}
.day1{
	border: solid;
	border-color: #B8E9FF;
	border-radius:0.5rem;
	border-width:2px;
	background-color: #B8E9FF;
	font-size: 2rem;
	color:white;
	padding: 1rem;
	padding-left:2rem;
	padding-right:2rem;
	display: flex;
	justify-content: center;
  	align-items: center;
	width:5vw;
	height:3.5vh;
}
.day2{
	width:6vw;
	margin:0.7rem;
	text-align:center;
	display: flex;
	flex-direction: column;
  	align-items: center;
  	justify-content: center;
}
.day3{
	margin:0.2rem;
	text-align:center;
}
/* ì½”ìŠ¤ë³´ì—¬ì£¼ëŠ”ê³³ */
/* í°ë©ì–´ë¦¬ */
.mymain{
	display: flex;
  	align-items: center;
	flex-direction: column;
	height: 70vh;
	margin: 2rem;
	margin-top:0;
	margin-bottom:5vh;
	overflow:auto;
}
.mymain::-webkit-scrollbar {
	display: none;
	font-family: 'Noto Sans KR Light', sans-serif;
}
.main{
	display:flex;
	width:45vw;
	height:12vh;
	border:solid;
	border-radius:1rem;
	border-width: 0.1rem;
	border-color: #BFBFBF;
	margin: 2rem;
	
	justify-content: center;
  	align-items: center;
	
}
.sec1{
	flex:1;
	margin:1rem;
	display:flex;
	justify-content: center;
	align-items:center;
	
}
.num{
	width:3rem;
	height:3rem;
	margin:1rem;
}
.sec2{
	flex:1;
	margin:1rem;
	
}
.placepic{
	width:13rem;
	height:8rem;
}
.sec3{
	flex:2;
	margin:1rem;
	
}
.placename{
	font-size:1.6rem;
}
.sec4{
	display:flex;
	flex:1;
	margin:1rem;
	
}
.sec4 > img{
	 cursor: pointer;
}
.info{
	width:4rem;
	height:4rem;
	margin:1rem;
	cursor:pointer;
}
.location{
	width:4rem;
	height:4rem;
	margin:1rem;
}
.courseinfobox{
	display:flex;
	align-items:center;
	width:50vw;
	font-size: 20px;
}

.left{
	display:flex;
	flex:9;
}
.courseInfo-title{
	display:flex;
	justify-content: left;
}
.courseInfo-date{
	margin-left:1vw;
	margin-right:auto;
	display:flex;
	justify-content: left;
}
.right{
	display:flex;
	flex:2;
}
#courseInfo-installText{
	margin-left:1vw;
	margoin-right:0;
	display:flex;
	justify-content: right;
}
#coursedetail-img{
	width:3vh;
	height:2.5vh;
	display:flex;
	justify-content: right;
	cursor: pointer;
}


.swiper-container {
	width: 50%; 
	height: 17vh;
}
.swiper-slide {
	width:15vw;
	height: 10vh;
	text-align: center;
	 /* ë‚´ìš©ì„ ì¤‘ì•™ì •ë ¬ í•˜ê¸°ìœ„í•´ flex ì‚¬ìš© */
	align-items: center; /* ìœ„ì•„ë˜ ê¸°ì¤€ ì¤‘ì•™ì •ë ¬ */
	justify-content: center; /* ì¢Œìš° ê¸°ì¤€ ì¤‘ì•™ì •ë ¬ */
	
}
.swiper-slide {
    position: relative;
    height: 10vh;
    bottom: 1.5vh;    
  }
.swiper-slide img {
	width:100%;
	height:100%;
	box-shadow: 0 0 5px #555;
	max-width: 100%; /* ì´ë¯¸ì§€ ìµœëŒ€ë„ˆë¹„ë¥¼ ì œí•œ, ìŠ¬ë¼ì´ë“œì— ì´ë¯¸ì§€ê°€ ì—¬ëŸ¬ê°œê°€ ë³´ì—¬ì§ˆë•Œ í•„ìš” */
}
.swiper-slide-day{
	margin-top: 2vh;
	margin-bottom: 1vh;
	width: 100%;
	display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}
.swiper-slide-day>button{
	font-weight: bold;
	margin-bottom:1vh;
}
.allDay-img-div {
	width: 8vw;
    height: 10vh;
    /* display: flex;
    justify-content: center;
 */
}
.day-img-div{
	width: 8vw;
    height: 10vh;
   	/* display: flex;
    justify-content: center; */

}
 .swiper-pagination-bullet-active{
  	background:#B8E9FF;
  }
  .swiper-button-prev, .swiper-container-rtl .swiper-button-next {
  	background-image: url(/resources/image/mainArrowleft.png);
  	
  }
  .swiper-button-next, .swiper-container-rtl .swiper-button-next {
  	background-image: url(/resources/image/mainArrowRight.png);
  }
  #courseInfo-installText{
  	margin-right:0.5vw;
  }
  
</style>

<script
	src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=L9YT0x6My9adXfumw1zGi2Gs24KLX3qS7depPI37"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script	src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.1/js/swiper.min.js"></script>

</head>

<body>
<div class="header">
		<div class="header-category">
			<div class="header-left">
				<a href="/plan" id="label-left-plan">ì¼ì • ë§Œë“¤ê¸°</a>
				<a href="/course/recommandcourse" id="label-left-course">ì½”ìŠ¤ì¶”ì²œ</a>
				 <a href="/community/communitymain" id="label-left-community">ì»¤ë®¤ë‹ˆí‹°</a> 
				 <a href="/chatting" id="label-left-chat">ë™í–‰êµ¬í•˜ê¸°</a>
			</div>
			<div class="header-center">
				<a href="/"><img src="/resources/image/logo.png" alt="" id="logimg"></a>
			</div>
				<!-- ë¡œê·¸ì¸ì „ --> 
			<div class ="header-right" th:if="${session.login == null}">
				<a href="/login" id="label-right-login">ë¡œê·¸ì¸</a> 
				<a href="/login/registerform" id="label-right-login">íšŒì›ê°€ì…</a>
			</div>
				<!-- ë¡œê·¸ì¸ í›„ -->
			<div class ="header-right" th:if="${session.login != null}" >
				<a href="/login/logout" id="label-right-login">ë¡œê·¸ì•„ì›ƒ</a>
				<a href="/login/usermain" id="label-right-register">ë§ˆì´í˜ì´ì§€</a>
			</div> 
		</div>
	</div>
	<div class="body">
		<div class="courseinfobox">
				<div class="left">
					<div class="courseInfo-title">[[${coursedetail.shareID}]] ì˜ [[${coursedetail.planName}]]</div>
					<div class="courseInfo-date">[[${coursedetail.courseFirstDate}]] ~ [[${coursedetail.courseLastDate}]]</div>
				</div>
				<div class="right">
					<div id="courseInfo-installText">ì €ì¥í•˜ê¸°</div>
					<div id="coursedetail-img"><img src="/resources/image/save.png"></div>
				</div>
		</div>
		<!--  ì§€ë„  -->
		<div class="map">
			<div id="map_div"></div>
		</div>
		<!-- ì§€ë„ ë°‘ ë²„íŠ¼ (ê²½ë¡œ ë¶ˆëŸ¬ì˜¤ëŠ”), í™”ë©´ì„¤ê³„ì„œë‘ ë‹¤ë¦„ -->
		<div class="swiper-container" id="swiper-container-course">
			<div class="swiper-wrapper">
			</div>
		<!-- ë„¤ë¹„ê²Œì´ì…˜ -->
		<div class="swiper-button-next" id="swiper-button-next-course"></div>
		<!-- ë‹¤ìŒ ë²„íŠ¼ (ì˜¤ë¥¸ìª½ì— ìˆëŠ” ë²„íŠ¼) -->
		<div class="swiper-button-prev" id="swiper-button-prev-course"></div>
		<!-- ì´ì „ ë²„íŠ¼ -->

		<!-- í˜ì´ì§• -->
		<div class="swiper-pagination" id="swiper-pagination-course"></div>
		</div>
		<!-- ë°‘ì— ë¦¬ìŠ¤íŠ¸ -->
	<!-- 	<div class="mymain_text"> -->
		</div>
		<div class="mymain">
		</div>
	
</body>

<script th:inline="javascript">
//ì¥ì†Œë³„ íŒì—…ì°½
var place = [[${placeInfo}]];
var courseimage = [[${courseimage}]];
	
function placePopup(placeName) {
  $.ajax({
    url: '/course/info',
    type: 'POST',
    data: { placeName: placeName },
    success: function(response) {
      openPopup(response.placeName, response.placeAddress, response.placePhone, response.placeContent, response.placeInfo, response.placeGood);
    },
    error: function(error) {
      console.error('Error:', error);
    }
  });
}

function openPopup(placeName,placeAddress,  placePhone, placeContent, placeInfo, placeGood, imagePath) {
	  var popupContainer = document.createElement("div");
	  popupContainer.setAttribute("id", "place_popupContainer");
	  popupContainer.setAttribute("class", "place_popup-container");

	  var popup = document.createElement("div");
	  popup.setAttribute("class", "place_popup");

	  popup.innerHTML = `
	  <br>
	  <div class="popup_imgcontainer">
		<img src="/resources/image/place/${placeName}.jpg">
		</div>
		<br><hr><br><br>
	    <h1>${placeName}</h1>
	    <br>
	    <p>ğŸ“ ${placeAddress}</p>
	    <p>ğŸ“ ${placePhone}</p>
	    <p>âœ”ï¸ ${placeInfo}</p>
	    <br>

	    <p>${placeContent}</p><br><br><hr>
	    <br>
	    <p class="recommend"><img src="/resources/image/insta_heart.png"/><span>ì¶”ì²œìˆ˜: ${placeGood}</span></p>
	    <span class="place_popup-close" onclick="closePopup()">X </span>
	    	`;

	  popupContainer.appendChild(popup);
	  document.body.appendChild(popupContainer);
	}


function closePopup() {
  var popupContainer = document.getElementById("place_popupContainer");
  if (popupContainer) {
    popupContainer.parentNode.removeChild(popupContainer);
  }
}
	
	  map = new Tmapv2.Map("map_div", {
	    center: new Tmapv2.LatLng(33.3616666, 126.5291666),
	    width: "50vw", // ì§€ë„ì˜ ë„“ì´
	    height: "50vh", // ì§€ë„ì˜ ë†’ì´
	    zoom: 10
	  });
	  
	  var new_polyLine = [];
	  var new_Click_polyLine = [];
	  function drawData(data, color){
		  	// ì§€ë„ìœ„ì— ì„ ì€ ë‹¤ ì§€ìš°ê¸°
		  	routeData = data;
		  	var resultStr = "";
		  	var distance = 0;
		  	var idx = 1;
		  	var newData = [];
		  	var equalData = [];
		  	var pointId1 = "-1234567";
		  	var ar_line = [];
		  	
		  	
		  	for (var i = 0; i < data.features.length; i++) {
		  		var feature = data.features[i];
		  		//ë°°ì—´ì— ê²½ë¡œ ì¢Œí‘œ ì €ì¥
		  		if(feature.geometry.type == "LineString"){
		  			ar_line = [];
		  			for (var j = 0; j < feature.geometry.coordinates.length; j++) {
		  				var startPt = new Tmapv2.LatLng(feature.geometry.coordinates[j][1],feature.geometry.coordinates[j][0]);
		  				ar_line.push(startPt);
		  				pointArray.push(feature.geometry.coordinates[j]);
		  			}
		  			var polyline = new Tmapv2.Polyline({
		  		        path: ar_line,
		  		        strokeColor: color, 
		  		        strokeWeight: 3,
		  		        map: map
		  		    });
		  			new_polyLine.push(polyline);
		  		}
		  		var pointId2 = feature.properties.viaPointId;
		  		if (pointId1 != pointId2) {
		  			equalData = [];
		  			equalData.push(feature);
		  			newData.push(equalData);
		  			pointId1 = pointId2;
		  		}
		  		else {
		  			equalData.push(feature);
		  		}
		  	}
		  	geoData = newData;
		  	var markerCnt = 1;
		  	for (var i = 0; i < newData.length; i++) {
		  		var mData = newData[i];
		  		var type = mData[0].geometry.type;
		  		var pointType = mData[0].properties.pointType;
		  		var pointTypeCheck = false; // ê²½ìœ ì§€ ì¼ë•Œë§Œ true
		  		if (mData[0].properties.pointType == "S") {
		  			var img = 'http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png';
		  			var lon = mData[0].geometry.coordinates[0];
		  			var lat = mData[0].geometry.coordinates[1];
		  		}
		  		else if (mData[0].properties.pointType == "E") {
		  			var img = 'http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_e.png';
		  			var lon = mData[0].geometry.coordinates[0];
		  			var lat = mData[0].geometry.coordinates[1];
		  		}
		  		else {
		  			markerCnt=i;
		  			var lon = mData[0].geometry.coordinates[0];
		  			var lat = mData[0].geometry.coordinates[1];
		  		}	
		  	}
		  }


		  // 2. ì‹œì‘, ë„ì°© ì‹¬ë³¼ì°ê¸°
		  var markerList = [];
		  var pointArray = [];
		  var markers = [];
		
		  var inputValues = [[${coursemarker}]];
		  var dates = Object.keys(inputValues[0]); // ë‚ ì§œ ë°°ì—´ ì–»ê¸°
		  // ë²„íŠ¼ì„ ì¶”ê°€í•  ì»¨í…Œì´ë„ˆ ì„ íƒ
		  var buttonContainer = document.getElementsByClassName('swiper-wrapper')[0];

		  var allButtonSwiperContent = document.createElement('div');
		  allButtonSwiperContent.className = "swiper-slide";
		  
		  var allDayButtondiv = document.createElement('div');
		  allDayButtondiv.className = "swiper-slide-day";
		  
		  var allDayImgdiv = document.createElement('div');
		  allDayImgdiv.className= "allDay-img-div";
	      var allImage = document.createElement('img');
	      allImage.src = '/resources/image/allDayImg3.jpg';
	      var allDaybutton = document.createElement('button');
			allDaybutton.textContent = 'All Day';

			allDaybutton.addEventListener('click', function() {
				  showAllDayRoute();
				  allMainContent(dates)
				});
			
	      allDayImgdiv.appendChild(allImage);
	      allDayButtondiv.appendChild(allDaybutton);
	      allDayButtondiv.appendChild(allDayImgdiv);
	      allButtonSwiperContent.appendChild(allDayButtondiv);
	      buttonContainer.appendChild(allButtonSwiperContent);
		  for (var i = 0; i < dates.length; i++) {
			  
			  var buttonSwiperContent = document.createElement('div');
			  buttonSwiperContent.className = "swiper-slide";
			  
			  var dayButtondiv = document.createElement('div');
			  dayButtondiv.className = "swiper-slide-day";
			  
		      var daybutton = document.createElement('button');
		      daybutton.textContent = 'Day ' + (i + 1);
		      
		      dayButtondiv.appendChild(daybutton);
		      buttonSwiperContent.appendChild(dayButtondiv);
		      
		      var dayImgdiv = document.createElement('div');
		      dayImgdiv.className= 'day-img-div';
		      var image = document.createElement('img');
		      image.src = '/resources/image/place/'+courseimage[i].placeName+'.jpg';
		      
		      dayImgdiv.appendChild(image);
		      dayButtondiv.appendChild(dayImgdiv);
		      buttonSwiperContent.appendChild(dayButtondiv);
		      buttonContainer.appendChild(buttonSwiperContent);
		      // í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬	
		      daybutton.addEventListener('click', function(event) {
		    	 var buttons = Array.from(buttonContainer.getElementsByTagName('button'));
		        var buttonIndex = buttons.indexOf(event.target);
		        var date = dates[buttonIndex - 1];
		        var selectedInputValue = inputValues[0][date];
		        var color = selectedInputValue.color;
		        var lonLatPairs = selectedInputValue.lonLatPairs;
		        var placeName = selectedInputValue.placeName;
				  updateMainContent(date, placeName, lonLatPairs, buttonIndex);

		        clearMarkers()
		        clearRoutes(); // ê¸°ì¡´ì˜ ê²½ë¡œ ì‚­ì œ
		        drawRoute(date, lonLatPairs, color);
		      });
		  }
		  
		  function updateMainContent(date, placeName, lonLatPairs, buttonIndex) {
			  
			  var mymainDiv = document.querySelector('.mymain');
			  mymainDiv.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
			  var mymainText = document.createElement('div');
			  mymainText.className = 'mymain_text';
  			  var day1Div = document.createElement('div');
  			  day1Div.className = 'day1';
  			  day1Div.textContent = 'Day' + (buttonIndex);
  			  mymainText.appendChild(day1Div);

  			// day2 ìš”ì†Œ
  			var day2Div = document.createElement('div');
  			day2Div.className = 'day2';
  			day2Div.textContent = date;
  			mymainText.appendChild(day2Div);
  			mymainDiv.appendChild(mymainText);
			  for (var i = 0; i < lonLatPairs.length; i++) {
				  (function(i) {
			    var mainDiv = document.createElement('div');
			    mainDiv.className = 'main';
			    mymainDiv.appendChild(mainDiv);
				
			    var sec1 = document.createElement('div');
			    sec1.className = 'sec1';
			    var numImg = document.createElement('img');
			    numImg.className = 'num';
			    numImg.src = '/resources/image/nums' + (i + 1) + '.png';
			    sec1.appendChild(numImg);
				
			    var sec2 = document.createElement('div');
			    sec2.className = 'sec2';
			    var placePicImg = document.createElement('img');
			    placePicImg.className = 'placepic';
			    placePicImg.src = '/resources/image/place/' + placeName[i].placeName + '.jpg';
			    sec2.appendChild(placePicImg);

			    var sec3 = document.createElement('div');
			    sec3.className = 'sec3';
			    var placeNameDiv = document.createElement('div');
			    placeNameDiv.className = 'placename';
			    placeNameDiv.textContent = placeName[i].placeName;
			    sec3.appendChild(placeNameDiv);

			    var sec4 = document.createElement('div');
			    sec4.className = 'sec4';
			    var infoImg = document.createElement('img');
			    infoImg.className = 'info';
			    infoImg.src = '/resources/image/exclamationmark.png';
			    sec4.appendChild(infoImg);
			    infoImg.addEventListener('click', function(event) {
			    	placePopup(placeName[i].placeName);
			    });

			    mainDiv.appendChild(sec1);
			    mainDiv.appendChild(sec2);
			    mainDiv.appendChild(sec3);
			    mainDiv.appendChild(sec4);
			  })(i);
			}
		  }
		
		  function allMainContent(dates) {
			  var mymainDiv = document.querySelector('.mymain');
			  mymainDiv.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

			for(var i = 0; i < dates.length; i++){
				
				var date = dates[i];
				var item = inputValues[0][date];
				var placeName = item.placeName;
				var lonLatPairs = item.lonLatPairs;
				var mymainTextdiv = document.createElement('div');
				mymainTextdiv.className = 'mymain_text';
  				var day1Div = document.createElement('div');
  				day1Div.className = 'day1';
  				day1Div.textContent = 'Day' + (i+1);
  				mymainTextdiv.appendChild(day1Div);

  				var day2Div = document.createElement('div');
  				day2Div.className = 'day2';
  				day2Div.textContent = date;
  				mymainTextdiv.appendChild(day2Div);
  				mymainDiv.appendChild(mymainTextdiv);
  				
			  for (var j = 0; j < lonLatPairs.length; j++) {
			    var mainDiv = document.createElement('div');
			    mainDiv.className = 'main';
			    mymainDiv.appendChild(mainDiv);
				
			    var sec1 = document.createElement('div');
			    sec1.className = 'sec1';
			    var numImg = document.createElement('img');
			    numImg.className = 'num';
			    numImg.src = '/resources/image/nums' + (j + 1) + '.png';
			    sec1.appendChild(numImg);
				
			    var sec2 = document.createElement('div');
			    sec2.className = 'sec2';
			    var placePicImg = document.createElement('img');
			    placePicImg.className = 'placepic';
			    placePicImg.src = '/resources/image/place/' + placeName[j].placeName + '.jpg';
			    sec2.appendChild(placePicImg);

			    var sec3 = document.createElement('div');
			    sec3.className = 'sec3';
			    var placeNameDiv = document.createElement('div');
			    placeNameDiv.className = 'placename';
			    placeNameDiv.textContent = placeName[j].placeName;
			    sec3.appendChild(placeNameDiv);

			    var sec4 = document.createElement('div');
			    sec4.className = 'sec4';
			    var infoImg = document.createElement('img');
			    infoImg.className = 'info';
			    infoImg.src = '/resources/image/exclamationmark.png';
			    infoImg.dataset.placeName = placeName[j].placeName; // placeName ê°’ì„ data-place-name ì†ì„±ìœ¼ë¡œ ì €ì¥
			    infoImg.addEventListener('click', function(event) {
			    	 var clickedImg = event.target; // í´ë¦­ëœ ì´ë¯¸ì§€ ìš”ì†Œë¥¼ ì°¸ì¡°
			    	  var clickedPlaceName = clickedImg.dataset.placeName; // í´ë¦­ëœ ì´ë¯¸ì§€ì˜ data-place-name ì†ì„± ê°’ì„ ì½ì–´ì˜´
			    	  placePopup(clickedPlaceName);
			      });
			    sec4.appendChild(infoImg);

			    mainDiv.appendChild(sec1);
			    mainDiv.appendChild(sec2);
			    mainDiv.appendChild(sec3);
			    mainDiv.appendChild(sec4);
			  }
			}
		  }

		  function clearRoutes() {
		      if (new_polyLine.length > 0) {
		          for (var i = 0; i < new_polyLine.length; i++) {
		              new_polyLine[i].setMap(null);
		          }
		          new_polyLine = [];
		      }
		      if (new_Click_polyLine.length > 0) {
		          for (var i = 0; i < new_Click_polyLine.length; i++) {
		              new_Click_polyLine[i].setMap(null);
		          }
		          new_Click_polyLine = [];
		      }
		  }
		  function clearMarkers() {
		  	  for (var i = 0; i < markers.length; i++) {
		  	    markers[i].setMap(null);
		  	  }
		  	  markers = [];
		  	}
		  function showAllDayRoute() {
			  // ê¸°ì¡´ ë§ˆì»¤ ì§€ìš°ê¸°
			  clearMarkers();
		for (var i = 0; i < dates.length; i++) {
			var date = dates[i];
			var item = inputValues[0][date];
			var color = item.color;
			var lonLatPairs = item.lonLatPairs;
			var waypoints = lonLatPairs.slice(1, lonLatPairs.length - 1);
			if(lonLatPairs.length === 1){
				addMarker("llPass", lonLatPairs[0].lat, lonLatPairs[0].lon, 1, color);
			}else{

			// ì‹œì‘
			addMarker("llStart", lonLatPairs[0].lat, lonLatPairs[0].lon, 1, color);
			// ë„ì°©
			addMarker("llEnd", lonLatPairs[lonLatPairs.length - 1].lat, lonLatPairs[lonLatPairs.length - 1].lon, 2, color);

			// ê²½ìœ ì§€ ì‹¬ë³¼ ì°ê¸°
			for (var j = 0; j < waypoints.length; j++) {
				var waypoint = waypoints[j];
				addMarker("llPass", waypoint.lat, waypoint.lon, j + 3, color);
			}
			// 4. ê²½ë¡œíƒìƒ‰ API ì‚¬ìš©ìš”ì²­
			}
			var startX = lonLatPairs[0].lat;
			var startY = lonLatPairs[0].lon;
			var endX = lonLatPairs[lonLatPairs.length - 1].lat;
			var endY = lonLatPairs[lonLatPairs.length - 1].lon;
			var passList = waypoints.map(function(waypoint) {
				  return waypoint.lat + ',' + waypoint.lon;
				}).join('_');
			var prtcl;
			var headers = {};
			
			headers["appKey"]="L9YT0x6My9adXfumw1zGi2Gs24KLX3qS7depPI37";
			$.ajax({
					method:"POST", 
					headers : headers, 
					url:"https://apis.openapi.sk.com/tmap/routes?version=1&format=json",//
					async:false,
					data:{ 
						startX : startX,
						startY : startY,
						endX : endX,
						endY : endY,
						passList : passList,
						reqCoordType : "WGS84GEO",
						resCoordType : "WGS84GEO",
						angle : "172",
						searchOption : "0",
						trafficInfo : "N"
					},
					success:function(response){
					prtcl = response;
					
					// 5. ê²½ë¡œíƒìƒ‰ ê²°ê³¼ Line ê·¸ë¦¬ê¸° 
					var trafficColors = {
						extractStyles:true,
						/* ì‹¤ì œ êµí†µì •ë³´ê°€ í‘œì¶œë˜ë©´ ì•„ë˜ì™€ ê°™ì€ Colorë¡œ Lineì´ ìƒì„±ë©ë‹ˆë‹¤. */
						trafficDefaultColor:"#636f63", //Default
						trafficType1Color:"#19b95f", //ì›í• 
						trafficType2Color:"#f15426", //ì§€ì²´
						trafficType3Color:"#ff970e"  //ì •ì²´		
					};    			
					var style_red = {
						fillColor:"#FF0000",
						fillOpacity:0.2,
						strokeColor: "#FF0000",
						strokeWidth: 3,
						strokeDashstyle: "solid",
						pointRadius: 2,
						title: "this is a red line"
					};
					drawData(prtcl, color);
				
				
		 			// 6. ê²½ë¡œíƒìƒ‰ ê²°ê³¼ ë°˜ê²½ë§Œí¼ ì§€ë„ ë ˆë²¨ ì¡°ì •
					  var center = new Tmapv2.LatLng(33.3616666, 126.5291666);
					  var zoom = 10; // í˜„ì¬ ì¤Œ ë ˆë²¨ ê°€ì ¸ì˜¤ê¸°
					  map.setCenter(center);
					  map.setZoom(zoom);
					},
					error:function(request,status,error){
				}
			});
			}
		  }
		  	function addMarker(status, lon, lat, tag, color) {
		  	//ì¶œë„ì°©ê²½ìœ êµ¬ë¶„
		  	//ì´ë¯¸ì§€ íŒŒì¼ ë³€ê²½.
		  	var markerLayer;
		  	switch (status) {
		  		case "llStart":
		  			img = '/resources/image/marker/'+color+'start.png';
		  			break;
		  		case "llPass":
		  			img = '/resources/image/marker/'+color+'pass.png';
		  			break;
		  		case "llEnd":
		  			img = '/resources/image/marker/'+color+'end.png';
		  			break;
		  		default:
		  	};
		  	var marker = new Tmapv2.Marker({
		  		position: new Tmapv2.LatLng(lat,lon),
		  		icon: img,
		  		map: map
		  	});
		  	// ë§ˆì»¤ ë“œë˜ê·¸ ì„¤ì •
		  	marker.tag = tag;
		  	marker.addListener("dragend", function (evt) {
		  	markerListenerEvent(evt);
		      });
		      marker.addListener("drag", function (evt) {    	
		      	markerObject = markerList[tag];
		      });
		      markerList[tag] = marker;
		      markers.push(marker);
		      return marker;
		  } 
		  	
		  	 function drawRoute(date, lonLatPairs, color) {
		  			var waypoints = lonLatPairs.slice(1, lonLatPairs.length - 1);
		  			if(lonLatPairs.length === 1){
		  				addMarker("llPass", lonLatPairs[0].lat, lonLatPairs[0].lon, 1, color);
		  			// 4. ê²½ë¡œíƒìƒ‰ API ì‚¬ìš©ìš”ì²­
					      var startX = lonLatPairs[0].lat;
					      var startY = lonLatPairs[0].lon;
					      var endX = lonLatPairs[lonLatPairs.length - 1].lat;
					      var endY = lonLatPairs[lonLatPairs.length - 1].lon;
					      var passList = waypoints.map(function(waypoint) {
					        return waypoint.lat + ',' + waypoint.lon;
					      }).join('_');
					      var prtcl;
					  	  var headers = {};
					      
					      headers["appKey"]="L9YT0x6My9adXfumw1zGi2Gs24KLX3qS7depPI37";
					      // ê²½ë¡œ íƒìƒ‰ API í˜¸ì¶œ
							$.ajax({
								method:"POST", 
								headers : headers, 
								url:"https://apis.openapi.sk.com/tmap/routes?version=1&format=json",//
								async:false,
								data:{ 
									startX : startX,
									startY : startY,
									endX : endX,
									endY : endY,
									passList : passList,
									reqCoordType : "WGS84GEO",
									resCoordType : "WGS84GEO",
									angle : "172",
									searchOption : "0",
									trafficInfo : "N"
								},
								success:function(response){
								prtcl = response;
								
								// 5. ê²½ë¡œíƒìƒ‰ ê²°ê³¼ Line ê·¸ë¦¬ê¸° 
								var trafficColors = {
									extractStyles:true,
									/* ì‹¤ì œ êµí†µì •ë³´ê°€ í‘œì¶œë˜ë©´ ì•„ë˜ì™€ ê°™ì€ Colorë¡œ Lineì´ ìƒì„±ë©ë‹ˆë‹¤. */
									trafficDefaultColor:"#636f63", //Default
									trafficType1Color:"#19b95f", //ì›í• 
									trafficType2Color:"#f15426", //ì§€ì²´
									trafficType3Color:"#ff970e"  //ì •ì²´		
								};    			
								var style_red = {
									fillColor:"#FF0000",
									fillOpacity:0.2,
									strokeColor: "#FF0000",
									strokeWidth: 3,
									strokeDashstyle: "solid",
									pointRadius: 2,
									title: "this is a red line"
								};
								drawData(prtcl, color);
							
							
								// 6. ê²½ë¡œíƒìƒ‰ ê²°ê³¼ ë°˜ê²½ë§Œí¼ ì§€ë„ ë ˆë²¨ ì¡°ì •
								  var center = new Tmapv2.LatLng(lonLatPairs[0].lon, lonLatPairs[0].lat);
								  var zoom = 16; // í˜„ì¬ ì¤Œ ë ˆë²¨ ê°€ì ¸ì˜¤ê¸°
								  map.setCenter(center);
								  map.setZoom(zoom);
								},
								error:function(request,status,error){
							}
						});
					      
		  			}else{

		  			// ì‹œì‘
		  			addMarker("llStart", lonLatPairs[0].lat, lonLatPairs[0].lon, 1, color);
		  			// ë„ì°©
		  			addMarker("llEnd", lonLatPairs[lonLatPairs.length - 1].lat, lonLatPairs[lonLatPairs.length - 1].lon, 2, color);

		  			// ê²½ìœ ì§€ ì‹¬ë³¼ ì°ê¸°
		  			for (var j = 0; j < waypoints.length; j++) {
		  				var waypoint = waypoints[j];
		  				addMarker("llPass", waypoint.lat, waypoint.lon, j + 3, color);
		  			}
		  			// 4. ê²½ë¡œíƒìƒ‰ API ì‚¬ìš©ìš”ì²­
		  			}
		  	      var startX = lonLatPairs[0].lat;
		  	      var startY = lonLatPairs[0].lon;
		  	      var endX = lonLatPairs[lonLatPairs.length - 1].lat;
		  	      var endY = lonLatPairs[lonLatPairs.length - 1].lon;
		  	      var passList = waypoints.map(function(waypoint) {
		  	        return waypoint.lat + ',' + waypoint.lon;
		  	      }).join('_');
		  	      var prtcl;
		  	  	  var headers = {};
		  	      
		  	      headers["appKey"]="L9YT0x6My9adXfumw1zGi2Gs24KLX3qS7depPI37";
		  	      // ê²½ë¡œ íƒìƒ‰ API í˜¸ì¶œ
		  			$.ajax({
		  				method:"POST", 
		  				headers : headers, 
		  				url:"https://apis.openapi.sk.com/tmap/routes?version=1&format=json",//
		  				async:false,
		  				data:{ 
		  					startX : startX,
		  					startY : startY,
		  					endX : endX,
		  					endY : endY,
		  					passList : passList,
		  					reqCoordType : "WGS84GEO",
		  					resCoordType : "WGS84GEO",
		  					angle : "172",
		  					searchOption : "0",
		  					trafficInfo : "N"
		  				},
		  				success:function(response){
		  				prtcl = response;
		  				
		  				// 5. ê²½ë¡œíƒìƒ‰ ê²°ê³¼ Line ê·¸ë¦¬ê¸° 
		  				var trafficColors = {
		  					extractStyles:true,
		  					/* ì‹¤ì œ êµí†µì •ë³´ê°€ í‘œì¶œë˜ë©´ ì•„ë˜ì™€ ê°™ì€ Colorë¡œ Lineì´ ìƒì„±ë©ë‹ˆë‹¤. */
		  					trafficDefaultColor:"#636f63", //Default
		  					trafficType1Color:"#19b95f", //ì›í• 
		  					trafficType2Color:"#f15426", //ì§€ì²´
		  					trafficType3Color:"#ff970e"  //ì •ì²´		
		  				};    			
		  				var style_red = {
		  					fillColor:"#FF0000",
		  					fillOpacity:0.2,
		  					strokeColor: "#FF0000",
		  					strokeWidth: 3,
		  					strokeDashstyle: "solid",
		  					pointRadius: 2,
		  					title: "this is a red line"
		  				};
		  				drawData(prtcl, color);
		  			
		  			
		  				// 6. ê²½ë¡œíƒìƒ‰ ê²°ê³¼ ë°˜ê²½ë§Œí¼ ì§€ë„ ë ˆë²¨ ì¡°ì •
		  				var newData = geoData[0];
		  				PTbounds = new Tmapv2.LatLngBounds();
		  						for (var i = 0; i < newData.length; i++) {
		  							var mData = newData[i];
		  							var type = mData.geometry.type;
		  							var pointType = mData.properties.pointType;
		  							if(type == "Point"){
		  								var linePt = new Tmapv2.LatLng(mData.geometry.coordinates[1],mData.geometry.coordinates[0]);
		  								PTbounds.extend(linePt);
		  							}
		  							else{
		  								var startPt,endPt;
		  								for (var j = 0; j < mData.geometry.coordinates.length; j++) {
		  									var linePt = new Tmapv2.LatLng(mData.geometry.coordinates[j][1],mData.geometry.coordinates[j][0]);
		  									PTbounds.extend(linePt);
		  								}
		  						}
		  					}
		  					map.fitBounds(PTbounds);
		  			
		  				},
		  				error:function(request,status,error){
		  			}
		  		});
		  	    }
		  // ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
		    var userID = [[${session.login}]];
		  	var imgWrapper = document.getElementById("coursedetail-img");
		  	var planName = [[${coursedetail.planName}]];
		  	var shareID = [[${coursedetail.shareID}]];
		  	
		  	// í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ ì •ì˜
		  	function handleClick() {
		  	  // í´ë¦­ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì‹¤í–‰í•  ë™ì‘ì„ ì—¬ê¸°ì— ì‘ì„±í•©ë‹ˆë‹¤.
		  	  	$.ajax({
					url:'/course/save',
					type: 'POST',
					data: {saveID:userID,
						   shareID:shareID,
						   planName:planName
						},
					success: function(data){
						if(data === 1){
							alert("ì½”ìŠ¤ê°€ ì €ì¥ ë˜ì—ˆìŠµë‹ˆë‹¤.");
							location.href='/login/usermain';
						}
					},
					error: function(data){
						alert(data);
					}
				});	
		  	  // ì¶”ê°€ì ì¸ ë™ì‘ì„ ìˆ˜í–‰í•˜ê±°ë‚˜ ë‹¤ë¥¸ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
		  	}

		  	// í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ë¥¼ ìš”ì†Œì— ì—°ê²°
		  	imgWrapper.addEventListener("click", handleClick);
		  	
		  	 window.onload = function() {
		  			// ê¸°ë³¸ì ìœ¼ë¡œ ì „ì²´ ê²½ë¡œ í‘œì‹œí•˜ê¸°
		  		allMainContent(dates);
		        showAllDayRoute();
		  	};
	 
</script>

<script type="text/javascript">
		new Swiper('.swiper-container', {

			slidesPerView : 3, // ë™ì‹œì— ë³´ì—¬ì¤„ ìŠ¬ë¼ì´ë“œ ê°¯ìˆ˜
			spaceBetween : 10, // ìŠ¬ë¼ì´ë“œê°„ ê°„ê²©
			slidesPerGroup : 3, // ê·¸ë£¹ìœ¼ë¡œ ë¬¶ì„ ìˆ˜, slidesPerView ì™€ ê°™ì€ ê°’ì„ ì§€ì •í•˜ëŠ”ê²Œ ì¢‹ìŒ

			// ê·¸ë£¹ìˆ˜ê°€ ë§ì§€ ì•Šì„ ê²½ìš° ë¹ˆì¹¸ìœ¼ë¡œ ë©”ìš°ê¸°
			// 3ê°œê°€ ë‚˜ì™€ì•¼ ë˜ëŠ”ë° 1ê°œë§Œ ìˆë‹¤ë©´ 2ê°œëŠ” ë¹ˆì¹¸ìœ¼ë¡œ ì±„ì›Œì„œ 3ê°œë¥¼ ë§Œë“¬
			loopFillGroupWithBlank : true,

			loop : false, // ë¬´í•œ ë°˜ë³µ

			pagination : { // í˜ì´ì§•
				el : '.swiper-pagination',
				clickable : true, // í˜ì´ì§•ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ ì˜ì—­ìœ¼ë¡œ ì´ë™, í•„ìš”ì‹œ ì§€ì •í•´ ì¤˜ì•¼ ê¸°ëŠ¥ ì‘ë™
			},
			navigation : { // ë„¤ë¹„ê²Œì´ì…˜
				nextEl : '.swiper-button-next', // ë‹¤ìŒ ë²„íŠ¼ í´ë˜ìŠ¤ëª…
				prevEl : '.swiper-button-prev', // ì´ë²ˆ ë²„íŠ¼ í´ë˜ìŠ¤ëª…
			},
		});
	</script>
</html>
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
<link href="./resources/css/plan.css" rel="stylesheet">
<script
	src="https://apis.openapi.sk.com/tmap/jsv2?version=1&appKey=L9YT0x6My9adXfumw1zGi2Gs24KLX3qS7depPI37"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script th:inline="javascript">
var loginchk = [[${session.login}]];
console.log(loginchk);
var markers = []; // ë§ˆì»¤ë¥¼ ë‹´ì„ ë°°ì—´
var placeData=[];
var map; // map ê°ì²´ ì„ ì–¸
// ì´ˆê¸° ë§ˆì»¤ ìƒì„±
var placeList = [[${placeRestaurantList}]];
let colorSelections = {};
var pageNum = 1;
var totalPages = 5; // ì „ì²´ í˜ì´ì§€ ìˆ˜

//ì˜ìˆ˜ì¦ì¸ì¦ íŒì—…ì°½
function openPopup() {
    var popupContainer = document.createElement("div");
    popupContainer.setAttribute("id", "ocr_popupContainer");
    popupContainer.setAttribute("class", "ocr_popup-container");

    var popup = document.createElement("div");
    popup.setAttribute("class", "ocr_popup");

    // íŒì—… ë‚´ìš© ì¶”ê°€
    popup.innerHTML = `
        <div id="ocr_title">ğŸ“ì˜ìˆ˜ì¦ ì¸ì¦</div>
        <div id="ocr_notice">* 2íšŒ ì´ìƒ ë°©ë¬¸ ì¸ì¦ì‹œì— ì¶”ì²œìˆ˜ê°€ ì˜¬ë¼ê°‘ë‹ˆë‹¤</div>
            <div class="filebox">
            	<div id="file_button">
	                <input type="file" id="attachFile" name="attachFile" onchange="readURL(this);">
	                <input type="button" value="ì¸ì¦í•˜ê¸°" id="submitBT" onclick="test()">
            	</div>
                <img id="preview"/>
                <input type="hidden" name="placeNumber" value="" id="placeNumber">
            </div>
        <span class="ocr_popup-close" onclick="closePopup()">X</span>
    `;

    popupContainer.appendChild(popup);
    document.body.appendChild(popupContainer);
}

function closePopup() {
    var popupContainer = document.getElementById("ocr_popupContainer");
    if (popupContainer) {
        popupContainer.parentNode.removeChild(popupContainer);
    }
}

// íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° í•¨ìˆ˜
function readURL(input) {
    var session = sessionStorage.getItem('placeNumber');
    document.getElementById("placeNumber").value = session;
    if (input.files && input.files[0]) {
        var reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('preview').src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
    } else {
        document.getElementById('preview').src = "";
    }
}

function test(){
	   var fileInput = document.getElementById("attachFile");
	     var placeNumberInput = document.getElementById("placeNumber");

	     var file = fileInput.files[0];
	     var placeNumber = placeNumberInput.value;

	     var formData = new FormData();
	     formData.append("attachFile", file);
	     formData.append("placeNumber", placeNumber);

	   $.ajax({
	      url: '/review/reviewwrite',
	      type: 'POST',
	      data: formData,
	      processData: false,
	      contentType: false,
	      success:function(data){
	          console.log(data);
	          var loginchk = [[${session.login}]];
	          console.log(loginchk);
	          		let res=data[0];
	          		let num=data[1];
	          		let userCheck=data[2];
	          		console.log(res);
	          		console.log(num);
	          		console.log(userCheck);
	                var placeNumber2 = num.placeNumber;
	                var placeName2 = num.placeName;
	                var placeAddress2 = num.placeAddress;
	             	// ê³µë°± ì œê±°
	                placeName2 = placeName2.replace(/\s/g, '');
	                placeAddress2 = placeAddress2.replace(/\s/g, '');

	                console.log(placeNumber2);
	                console.log(placeName2);
	                console.log(placeAddress2);
	                  //let res = '[(${res})]'; // Thymeleaf ë¬¸ë²•ìœ¼ë¡œ res ê°’ì„ ê°€ì ¸ì˜´
	                  //let num = '[(${num})]';
	                  //let userCheck = [[(${userCheck})]];
	                  var userCheckcnt=0;
	                  var dateCheckcnt=-1;
	                  var dateCheckdata;
	                  
	                  for(var i=0;i<userCheck.length;i++){
	                  	dateCheckcnt++;
	                      if (loginchk == userCheck[i].recommandUserID) {
	                          userCheckcnt++;
	                          dateCheckdata=userCheck[i].recommandDate;
	                          console.log(dateCheckdata);
	                      }
	                  }
	                  /*
	                  let placeNumber = num.match(/placeNumber=([^,]+)/)[1];
	                  let placeName = num.match(/placeName=([^,]+)/)[1];
	                  let placeAddress = num.match(/placeAddress=([^,]+)/)[1];
	                  console.log(placeNumber);
	                  let check="";
	                  
	      	        // ê´„í˜¸ ì œê±°í•˜ê¸°
	      	        placeAddress = placeAddress.replace(/\(|\)/g, '');
	      	        placeAddress = placeAddress.replace(/\s/g, '');
	                  console.log(placeName);
	                  console.log(placeAddress);*/
	                  let check="";
	                  if (res) {
	                      res = JSON.parse(res); // JSON ë¬¸ìì—´ì„ JavaScript ê°ì²´ë¡œ ë³€í™˜
	                      for (let i = 0; i < res.images[0].fields.length; i++) {
	                          check+=res.images[0].fields[i].inferText;
	                      }
	                      console.log(check);

	                      var date;
	                      var regex = /(200[0-9]|201[0-9]|202[0-3])-(0[1-9]|1[0-2])-(0[1-9]|[12][0-9]|3[01])/g;
	                      var result = check.match(regex);
	                      if (result) {
	                      	  date = new Date(result[0]);
	                      	}
	                      
	                      
	                      var placeCheckcnt=0;
	                      var db_check=0;
	                  
	                   
	                      if (check.includes(placeAddress2)) {
	                          console.log("placeAddress ê°’ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.");
	                          placeCheckcnt++;
	                      } else {
	                          console.log("placeAddress ê°’ì´ í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.");
	                      }
	                      if (check.includes(placeName2)) {
	                          console.log("placeName ê°’ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.");
	                          placeCheckcnt++;
	                      } else {
	                          console.log("placeName ê°’ì´ í¬í•¨ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.");
	                      }
	                      console.log(dateCheckdata);
	          			console.log(date);

	                      if(placeCheckcnt==2){
	                      	if(userCheckcnt==0){
	                      		alert("ì²«ë²ˆì§¸ ì˜ìˆ˜ì¦ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤");
	                      		closePopup();
	                      		db_check=1;
	                      		// ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•˜ì—¬ DBì— ì‚½ì…
	                              $.ajax({
	                                  url: '/review/insertRecommandData', // ë°±ì—”ë“œ API ì—”ë“œí¬ì¸íŠ¸
	                                  type: 'POST',
	                                  data: {
	                                      userID: loginchk,
	                                      placeNumber: placeNumber2,
	                                      date: date,
	                                      db_check: db_check
	                                  },
	                                  success: function(response) {
	                                      console.log(response);
	                                  },
	                                  error: function(error) {
	                                      console.log(error);
	                                  }
	                              });
	                      	}
	                      	else if(userCheckcnt==1){
	                      		if(dateCheckdata!=date){
	                      			console.log(dateCheckdata);
	                      			console.log(date);
	                      			alert("ë‘ë²ˆì§¸ ì˜ìˆ˜ì¦ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‚´ ì¶”ì²œëª©ë¡ì— ì¶”ê°€ë©ë‹ˆë‹¤");
	                      			closePopup();
	                      			db_check=2;
	                      			 // ë°ì´í„°ë¥¼ ì„œë²„ë¡œ ì „ì†¡í•˜ì—¬ DBì— ì‚½ì…
	                                  $.ajax({
	                                      url: '/review/insertRecommandData', // ë°±ì—”ë“œ API ì—”ë“œí¬ì¸íŠ¸
	                                      type: 'POST',
	                                      data: {
	                                          userID: loginchk,
	                                          placeNumber: placeNumber2,
	                                          date: date,
	                                          db_check: db_check
	                                      },
	                                      success: function(response) {
	                                          console.log(response);
	                                      },
	                                      error: function(error) {
	                                          console.log(error);
	                                      }
	                                  });
	                      		}
	                      		else{
	                      			alert("ì´ì „ì— ì¸ì¦í•œ ë‚ ì§œ ì˜ìˆ˜ì¦ì…ë‹ˆë‹¤");
	                      			closePopup();
	                      		}
	                      	}
	                      	else if(userCheckcnt>1){
	                      		alert("ë‘ë²ˆ ì´ìƒ ì¸ì¦í•˜ì…¨ìŠµë‹ˆë‹¤");
	                      		closePopup();
	                      	}
	                      }
	                      else alert("ì˜ìˆ˜ì¦ê³¼ ì¥ì†Œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤");
	                      closePopup();
	                  }
	                  
	       },
	       error:function(data){
	          alert("ì‹¤íŒ¨");
	       }
	   });
	}
	

var loginchk = [[${session.login}]];
console.log(loginchk);
var placeData=[];
var map; // map ê°ì²´ ì„ ì–¸
var map2;
// ì´ˆê¸° ë§ˆì»¤ ìƒì„±

/* function reloadStylesheet() {
	  var links = document.getElementsByTagName('link');
	  for (var i = 0; i < links.length; i++) {
	    if (links[i].rel === 'stylesheet') {
	      var href = links[i].href;
	      links[i].href = ''; // ìŠ¤íƒ€ì¼ì‹œíŠ¸ URLì„ ë¹„ì›ë‹ˆë‹¤.
	      links[i].href = '/resources/css/plan.css'; // ìŠ¤íƒ€ì¼ì‹œíŠ¸ URLì„ ë‹¤ì‹œ ì„¤ì •í•˜ì—¬ ì¬ë¡œë“œí•©ë‹ˆë‹¤.
	    }
	  }
	} */
function initTmap() {
	  // map ìƒì„±
	  map = new Tmapv2.Map("map_div", {
	    center: new Tmapv2.LatLng(33.3616666, 126.5291666),
	    width: "50vw", // ì§€ë„ì˜ ë„“ì´
	    height: "80vh", // ì§€ë„ì˜ ë†’ì´
	    zoom: 11
	  });
	  
	  createMarkers(placeList);
	  
	}
function previewTmap(){
	  map2 = new Tmapv2.Map("preview_div", {
			center: new Tmapv2.LatLng(33.3616666, 126.5291666),
			width: "100%",
			height: "400px",
			zoom: 10
		});
}
function insertTmap(){
	  map2 = new Tmapv2.Map("insert_div", {
			center: new Tmapv2.LatLng(33.3616666, 126.5291666),
			width: "100%",
			height: "400px",
			zoom: 10
		});
}
function fetchUpdatedMarkers(category, pageNum) {
	
    $.ajax({
      url: '/plan/fetchMarkers',
      method: 'GET',
      data: { category: category,
    	      pageNum: pageNum},
      success: function (data) {
    	  updateList(data.placeList);
    	  createMarkers(data.placeList);
    	  updatePagination(data.totalPages, data.currentPage);
    	  
      },
      error: function () {
        console.log('Failed to fetch updated markers.');
      }
    });
  }
  
function fetchUpdatedMarkerssearch(keyword, pageNum) {
	
    $.ajax({
      url: '/plan/search',
      method: 'POST',
      data: { keyword: keyword,
    	      pageNum: pageNum},
      success: function (data) {
    	  updateList(data.placeList);
    	  createMarkers(data.placeList);
    	  updatePaginationsearch(data.totalPages, data.currentPage, keyword);
    	  
      },
      error: function () {
        console.log('Failed to fetch updated markers.');
      }
    });
  }
function updateList(data) {
	var listContainer = document.querySelector('.list');
	  listContainer.innerHTML = ''; // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ ë‚´ìš© ì´ˆê¸°í™”
	  data.forEach(function (restaurant) {
	    var listItem = document.createElement('div');
	    listItem.id = 'left_block';
		
	    var inputCategory = document.createElement('input');
	    inputCategory.type = 'hidden';
	    inputCategory.name = 'placeCategory';
	    inputCategory.value = restaurant.placeCategory;
	    listItem.appendChild(inputCategory);
	    
	    var inputLon = document.createElement('input');
	    inputLon.type = 'hidden';
	    inputLon.name = 'planLon';
	    inputLon.value = restaurant.placeLon;
	    listItem.appendChild(inputLon);

	    var inputLat = document.createElement('input');
	    inputLat.type = 'hidden';
	    inputLat.name = 'planLat';
	    inputLat.value = restaurant.placeLat;
	    listItem.appendChild(inputLat);

	    var listImg = document.createElement('div');
	    listImg.id = 'list-img';
	    var img = document.createElement('img');
	    img.src = './resources/image/place/' + restaurant.placeName + '.jpg';
	    img.alt = '';
	    listImg.appendChild(img);
	    listItem.appendChild(listImg);

	    var listName = document.createElement('div');
	    listName.id = 'list-name';

	    var listNameLabel = document.createElement('div');
	    listNameLabel.id = 'list-name-label';
	    var nameLabel = document.createElement('label');
	    nameLabel.textContent = restaurant.placeName;
	    listNameLabel.appendChild(nameLabel);
	    listName.appendChild(listNameLabel);

	    var listNameHeartimg = document.createElement('div');
	    listNameHeartimg.id = 'list-name-heartimg';

	    var heartImg = document.createElement('div');
	    var imgHeart = document.createElement('img');
	    imgHeart.src = '/resources/image/place_heart.png';
	    imgHeart.alt = '';
	    imgHeart.id = 'heart';
	    heartImg.appendChild(imgHeart);
	    listNameHeartimg.appendChild(heartImg);

	    var listNameHeartimgLabel = document.createElement('div');
	    listNameHeartimgLabel.id = 'list-name-heartimg-label';
	    var heartLabel = document.createElement('label');
	    heartLabel.textContent = restaurant.placeGood;
	    listNameHeartimgLabel.appendChild(heartLabel);
	    listNameHeartimg.appendChild(listNameHeartimgLabel);

	    listName.appendChild(listNameHeartimg);
	    listItem.appendChild(listName);

	    var listPlus = document.createElement('div');
	    listPlus.id = 'list-plus';
	    var plusImg = document.createElement('img');
	    plusImg.src = './resources/image/plus.png';
	    plusImg.alt = '';
	    plusImg.id = 'plus';
	    listPlus.appendChild(plusImg);
	    listItem.appendChild(listPlus);

	    listContainer.appendChild(listItem);
	    
	 /* // CSS ìŠ¤íƒ€ì¼ì‹œíŠ¸ ì¬ë¡œë“œ
	    reloadStylesheet(); */
	  });
}
var selectedMarkerChart1 = null; // í´ë¦­ëœ ë§ˆì»¤ì— ëŒ€í•œ ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì €ì¥í•  ë³€ìˆ˜ (chartCanvas)
var selectedMarkerChart2 = null; // í´ë¦­ëœ ë§ˆì»¤ì— ëŒ€í•œ ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì €ì¥í•  ë³€ìˆ˜ (chartCanvas2)

function createMarkers(data) {
    // ì´ì „ì— ìƒì„±ëœ ë§ˆì»¤ ì‚­ì œ
    // ìˆ¨ê¸¸ ìš”ì†Œì™€ ë‚˜íƒ€ë‚¼ ìš”ì†Œë¥¼ ë³€ìˆ˜ë¡œ ì €ì¥
	var mainLeft = document.getElementsByClassName("main-left")[0];
	var placeMenu = document.getElementsByClassName("placemenu")[0];
    for (var i = 0; i < markers.length; i++) {
      markers[i].setMap(null);
    }
    markers = [];
	placeData = [];
    // ìƒˆë¡œìš´ ë§ˆì»¤ ìƒì„±
    for (var i = 0; i < data.length; i++) {
      var place = data[i];
      var marker = new Tmapv2.Marker({
        position: new Tmapv2.LatLng(place.placeLon, place.placeLat),
        map: map,
        title: place.placeName
      });
      
      marker.setIcon("/resources/image/mk.png");
      markers.push(marker); // ìƒì„±ëœ ë§ˆì»¤ë¥¼ ë°°ì—´ì— ì¶”ê°€
      
      var extractedValue2 = {
    		placeNumber: place.placeNumber,
      		placeName: place.placeName,
      		placeAddress: place.placeAddress,
      		placePhone: place.placePhone,
      		placeGood: place.placeGood,
      		placeInfo: place.placeInfo,
      		placeTag1: place.placeTag1,
      		placeTag2: place.placeTag2,
      		placeTag3: place.placeTag3
            };
      placeData.push(extractedValue2);
    }
    var selectedMarker = null; // í´ë¦­ëœ ë§ˆì»¤ë¥¼ ì €ì¥í•  ë³€ìˆ˜ ì¶”ê°€
    
    document.getElementById("placemenu_button").onclick = function () {
    	mainLeft.style.display = 'block';
	      placeMenu.style.display = 'none';
	      if (selectedMarker !== null) {
                selectedMarker.setIcon("/resources/image/mk.png");
          }
      };
      

    
    // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
    for (var i = 0; i < markers.length; i++) {
	  (function(index) {
	    markers[index].addListener("click", function(evt) {
	    	      var marker = markers[index];
	      var placedata = placeData[index];
	      var placeNumber = placedata.placeNumber;
	      console.log(marker);
	      console.log(placedata);
	   	  // ì´ì „ì— í´ë¦­ëœ ë§ˆì»¤ê°€ ìˆì„ ê²½ìš° ì•„ì´ì½˜ì„ ì›ë˜ëŒ€ë¡œ ë˜ëŒë¦¼
          if (selectedMarker !== null) {
                selectedMarker.setIcon("/resources/image/mk.png");
          }
	      
       // ì´ì „ì— í´ë¦­ëœ ë§ˆì»¤ì— ëŒ€í•œ ì°¨íŠ¸ë¥¼ íŒŒê´´
          if (selectedMarkerChart1 !== null) {
            selectedMarkerChart1.destroy();
          }
          if (selectedMarkerChart2 !== null) {
            selectedMarkerChart2.destroy();
          }
       
        sessionStorage.setItem('placeNumber', placedata.placeNumber);
	      marker.setIcon("/resources/image/m11.png");
	      
	      // ìš”ì†Œì˜ ìŠ¤íƒ€ì¼ ì†ì„±ì„ ì¡°ì‘í•˜ì—¬ ë‚˜íƒ€ë‚´ê±°ë‚˜ ìˆ¨ê¹€
	      mainLeft.style.display = 'none';
	      placeMenu.style.display = 'block';
	      
	      document.getElementById("placeImage").src = "/resources/image/place/" + placedata.placeName + ".jpg"; // ì´ë¯¸ì§€ ê²½ë¡œë¥¼ ì´ë¯¸ì§€ ìš”ì†Œì— í• ë‹¹
	      document.getElementById("datatest1").innerText = placedata.placeName;
	      document.getElementById("datatest2").innerText = placedata.placeAddress;
	      document.getElementById("datatest3").innerText = placedata.placePhone;
	      document.getElementById("datatest4").innerText = placedata.placeGood;
	      document.getElementById("datatest5").innerText = placedata.placeInfo;
	      document.getElementById("datatest6").innerText = placedata.placeTag1;
	      document.getElementById("datatest7").innerText = placedata.placeTag2;
	      document.getElementById("datatest8").innerText = placedata.placeTag3;
	      
	   	  // í´ë¦­ëœ ë§ˆì»¤ë¥¼ selectedMarker ë³€ìˆ˜ì— ì €ì¥
        selectedMarker = marker;
	   	console.log("click :"+placeNumber);
	   	selectedMarkerChartId = "chart" + index;  // ê° ë§ˆì»¤ì— ëŒ€í•œ ê³ ìœ í•œ ID ìƒì„±
	      
        
        $.ajax({
						    url: '/plan/genderList',
						    type: 'GET',
						    data: { recommandPlaceNumber : placeNumber },
						    success: function(data2){
						    	console.log("gender : "+data2.length);
						    	if(data2.length == 0){
						    		return false;
						    	}
						    	var count1 = data2[0].count;
					            var count2 = data2[1].count;
						    	console.log(data2[0].count);
						    	console.log(data2[1].count);
						    	
						    	var total = count1 + count2;
						    	  var ratio1 = count1 / total;
						    	  var ratio2 = count2 / total;
						    	  
						    	  var percentage1 = (ratio1 * 100).toFixed(0) + "%";
						    	  var percentage2 = (ratio2 * 100).toFixed(0) + "%";

						    	  var ctx = document.getElementById("chartCanvas").getContext("2d");
						    	  if (selectedMarkerChart1) {
						              selectedMarkerChart1.destroy();
						            }
						            selectedMarkerChart1 = new Chart(ctx, {
						    	    type: 'pie',
						    	    data: {
						    	      labels: ["ì—¬ì„±(" + percentage1 + ")", "ë‚¨ì„±(" + percentage2 + ")"],
						    	      datasets: [{
						    	        data: [ratio1, ratio2],
						    	        backgroundColor: ['#FF6384', '#36A2EB'],
						    	        borderWidth: 1
						    	      }]
						    	    },
					                options: {
					                  responsive: true
					                }
					              });
					            },
					            error: function (xhr, status, error) {
					              console.error(error);
					            }
					          });
				      $.ajax({
						    url: '/plan/birthList',
						    type: 'GET',
						    data: { recommandPlaceNumber : placeNumber },
						    success: function(data3){
						    	console.log("birth : "+data3);
						    	if(data3.length == 0){
						    		
						    		return false;
						    	}
						    	var ageCategories = {
						    		      "10ëŒ€": 0,
						    		      "20ëŒ€": 0,
						    		      "30ëŒ€": 0,
						    		      "40ëŒ€": 0,
						    		      "50ëŒ€": 0
						    		      //"60ëŒ€": 0
						    		    };
						    	for(var i=0;i<data3.length;i++){
						    		var birthYear = parseInt(data3[i].userBirth);
						    	      var age = new Date().getFullYear() - birthYear + 1;

						    	      if (age >= 10 && age < 20) {
						    	        ageCategories["10ëŒ€"]++;
						    	      } else if (age >= 20 && age < 30) {
						    	        ageCategories["20ëŒ€"]++;
						    	      } else if (age >= 30 && age < 40) {
						    	        ageCategories["30ëŒ€"]++;
						    	      } else if (age >= 40 && age < 50) {
						    	        ageCategories["40ëŒ€"]++;
						    	      } else if (age >= 50 && age < 60) {
						    	        ageCategories["50ëŒ€"]++;
						    	      } 
						    	}
						    	var ctx = document.getElementById("chartCanvas2").getContext("2d");
						    	if (selectedMarkerChart2) {
						              selectedMarkerChart2.destroy();
						            }
						            selectedMarkerChart2 = new Chart(ctx, {
						    	      type: 'bar',
						    	      data: {
						    	        labels: Object.keys(ageCategories).map(function(label) {
						    	          //return label + "(" + ageCategories[label] + "ëª…)";
						    	        	return label ;
						    	        }),
						    	        datasets: [{
						    	          label: 'ì—°ë ¹ëŒ€ ë¹„ìœ¨',
						    	          data: Object.values(ageCategories),
						    	          backgroundColor: '#B8E9FF',
						    	          borderColor: 'rgba(0, 123, 255, 0.8)',
						    	          borderWidth: 1
						    	        }]
						    	      },
						    	      options: {
						    	        responsive: true,
						    	        scales: {
						    	          y: {
						    	        	  display: false,
						    	            beginAtZero: true,
						    	            ticks: {
						    	              stepSize: 1,
						    	              callback: function(value) {
						    	                return value.toString();
						    	              }
						    	            }
						    	          },
						    	          x: {
						    	            grid: {
						    	              display: false
						    	            }
						    	          }
						    	        },
						    	        plugins: {
						    	          legend: {
						    	            display: false
						    	          },
						    	          tooltip: {
						    	            callbacks: {
						    	              label: function(context) {
						    	                var label = context.label || '';
						    	                var value = context.parsed.y || 0;
						    	                return label + ': ' + value;
						    	              }
						    	            }
						    	          }
						    	        }
						    	      }
						    	    });
						    	  },
					            error: function (xhr, status, error) {
					              console.error(error);
					            }
					          });
	    });
	  })(i);
	}
    createPlusClickEvent();
  }
  document.addEventListener('DOMContentLoaded', function () {
    var restaurantBtn = document.getElementById('restaurant-btn');
    restaurantBtn.addEventListener('click', function () {
      fetchUpdatedMarkers('restaurant', pageNum);
    });

    var youtubeBtn = document.getElementById('youtube-btn');
    youtubeBtn.addEventListener('click', function () {
      fetchUpdatedMarkers('youtube', pageNum);
    });

    var touristBtn = document.getElementById('tourist-btn');
    touristBtn.addEventListener('click', function () {
      fetchUpdatedMarkers('tourist', pageNum);
    });

    var hillBtn = document.getElementById('hill-btn');
    hillBtn.addEventListener('click', function () {
      fetchUpdatedMarkers('hill', pageNum);
    });

    var ollegilBtn = document.getElementById('ollegil-btn');
    ollegilBtn.addEventListener('click', function () {
      fetchUpdatedMarkers('ollegil', pageNum);
    });
  });
  function createPlusClickEvent() {
	  var plusElements = document.querySelectorAll('#list-plus');
	  plusElements.forEach(function(plus) {
	    plus.addEventListener('click', function() {
	      // í´ë¦­ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
	      // í´ë¦­í•œ plus ìš”ì†Œì˜ ë¶€ëª¨ì¸ main-left divë¥¼ ì°¾ì•„ ë³µì‚¬
	      var mainLeft = this.parentNode;
	      var coursePlan = document.querySelector('.course-plan');
	      // main-left div ë³µì‚¬
	      var clonedMainLeft = mainLeft.cloneNode(true);

	      // course-plan divì—ì„œ ê¸°ì¡´ì˜ list divë¥¼ ì°¾ì•„ ê°€ì ¸ì˜´
	      var listContainer = coursePlan.querySelector(`#course-list-${currentDay}`);

	      var isDuplicate = Array.from(listContainer.querySelectorAll('#left_block')).some(function(listItem) {
	    	  var listItemLabel = listItem.querySelector('#list-name-label label');
	    	  var listItemText = listItemLabel ? listItemLabel.textContent.toLowerCase() : '';
	    	  var clonedMainLeftLabel = clonedMainLeft.querySelector('#list-name-label label');
	    	  var clonedMainLeftText = clonedMainLeftLabel ? clonedMainLeftLabel.textContent.toLowerCase() : '';
	    	  if (listItemText === clonedMainLeftText) {
	    	    return true;  // ì¤‘ë³µë˜ëŠ” ê²½ìš° true ë°˜í™˜
	    	  }

	    	  return false;  // ì¤‘ë³µë˜ì§€ ì•ŠëŠ” ê²½ìš° false ë°˜í™˜
	    	});
	      if (isDuplicate) {
	        alert('ì´ë¯¸ ì¶”ê°€ëœ ì¥ì†Œì…ë‹ˆë‹¤.'); // ì¤‘ë³µëœ ì¥ì†Œì¸ ê²½ìš° ê²½ê³ ì°½ í‘œì‹œ
	        return;  // ì¤‘ë³µë˜ëŠ” ì¥ì†Œì¸ ê²½ìš° í•¨ìˆ˜ ì¢…ë£Œ
	      }

	      // ë³µì‚¬í•œ main-left divì—ì„œ plus ì´ë¯¸ì§€ë¥¼ ì œê±°
	      var plusElement = clonedMainLeft.querySelector('#list-plus');
	      plusElement.remove();

	      // list-name-heartimg ìš”ì†Œ ì œê±°
	      var listNameHeartImg = clonedMainLeft.querySelector('#list-name-heartimg');
	      listNameHeartImg.remove();

	      var listMinusDiv = document.createElement('div');
	      listMinusDiv.setAttribute('id', 'list-minus');

	      // list-minus ì´ë¯¸ì§€ ìƒì„±
	      var listMinusImg = document.createElement('img');
	      listMinusImg.setAttribute('src', './resources/image/minus.png');
	      listMinusImg.setAttribute('alt', '');

	      // list-minus ì´ë¯¸ì§€ë¥¼ list-minus divì— ì¶”ê°€
	      listMinusDiv.appendChild(listMinusImg);

	      // ë³µì‚¬í•œ main-left divì— list-minus div ì¶”ê°€
	      clonedMainLeft.appendChild(listMinusDiv);
	      
	      // í˜„ì¬ Dayì— í•´ë‹¹í•˜ëŠ” course-listì—ë§Œ ë³µì‚¬ëœ main-left div ì¶”ê°€
	      var currentCourseList = document.getElementById(`course-list-${currentDay}`);
	      var clonedMainLeftCopy = clonedMainLeft.cloneNode(true);
	      currentCourseList.appendChild(clonedMainLeftCopy);

	      // í˜„ì¬ Dayì— í•´ë‹¹í•˜ëŠ” course-list ë‹¤ì‹œ í‘œì‹œ
	      showCurrentDay();

	    });
	  });
	  // minus ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
	  var coursePlan = document.querySelector('.course-plan');
	  coursePlan.addEventListener('click', function(event) {
	    if (event.target.parentNode && event.target.parentNode.id === 'list-minus') {
	      var parentMainLeft = event.target.parentNode.parentNode;
	      parentMainLeft.remove();
	      showCurrentDay();
	    }
	    });
	}

  let nowMonth = new Date(); // í˜„ì¬ ë‹¬ì„ í˜ì´ì§€ë¥¼ ë¡œë“œí•œ ë‚ ì˜ ë‹¬ë¡œ ì´ˆê¸°í™”
  let today = new Date(); // í˜ì´ì§€ë¥¼ ë¡œë“œí•œ ë‚ ì§œë¥¼ ì €ì¥
  today.setHours(0, 0, 0, 0); // ë¹„êµ í¸ì˜ë¥¼ ìœ„í•´ todayì˜ ì‹œê°„ì„ ì´ˆê¸°í™”

  let selectedStartDate = null; // ì„ íƒëœ ì‹œì‘ ë‚ ì§œ
  let selectedEndDate = null; // ì„ íƒëœ ì¢…ë£Œ ë‚ ì§œ

  // ë‹¬ë ¥ ìƒì„± : í•´ë‹¹ ë‹¬ì— ë§ì¶° í…Œì´ë¸”ì„ ë§Œë“¤ê³ , ë‚ ì§œë¥¼ ì±„ì›Œ ë„£ëŠ”ë‹¤.
  function buildCalendar() {
    let firstDate = new Date(nowMonth.getFullYear(), nowMonth.getMonth(), 1); // ì´ë²ˆë‹¬ 1ì¼
    let lastDate = new Date(nowMonth.getFullYear(), nowMonth.getMonth() + 1, 0); // ì´ë²ˆë‹¬ ë§ˆì§€ë§‰ë‚ 

    let tbody_Calendar = document.querySelector(".Calendar-table > tbody");
    document.getElementById("calYear").innerText = nowMonth.getFullYear(); // ì—°ë„ ìˆ«ì ê°±ì‹ 
    document.getElementById("calMonth").innerText = leftPad(nowMonth.getMonth() + 1); // ì›” ìˆ«ì ê°±ì‹ 

    while (tbody_Calendar.rows.length > 0) { // ì´ì „ ì¶œë ¥ê²°ê³¼ê°€ ë‚¨ì•„ìˆëŠ” ê²½ìš° ì´ˆê¸°í™”
      tbody_Calendar.deleteRow(tbody_Calendar.rows.length - 1);
    }

    let nowRow = tbody_Calendar.insertRow(); // ì²«ë²ˆì§¸ í–‰ ì¶”ê°€

    for (let j = 0; j < firstDate.getDay(); j++) { // ì´ë²ˆë‹¬ 1ì¼ì˜ ìš”ì¼ë§Œí¼
      let nowColumn = nowRow.insertCell(); // ì—´ ì¶”ê°€
    }

    for (let nowDay = firstDate; nowDay <= lastDate; nowDay.setDate(nowDay.getDate() + 1)) { // dayëŠ” ë‚ ì§œë¥¼ ì €ì¥í•˜ëŠ” ë³€ìˆ˜, ì´ë²ˆë‹¬ ë§ˆì§€ë§‰ë‚ ê¹Œì§€ ì¦ê°€ì‹œí‚¤ë©° ë°˜ë³µ
      let nowColumn = nowRow.insertCell(); // ìƒˆ ì—´ì„ ì¶”ê°€í•˜ê³ 
      nowColumn.innerText = leftPad(nowDay.getDate()); // ì¶”ê°€í•œ ì—´ì— ë‚ ì§œ ì…ë ¥

      if (nowDay.getDay() === 0) { // ì¼ìš”ì¼ì¸ ê²½ìš° ê¸€ììƒ‰ ë¹¨ê°•ìœ¼ë¡œ
        nowColumn.style.color = "#DC143C";
      }
      if (nowDay.getDay() === 6) { // í† ìš”ì¼ì¸ ê²½ìš° ê¸€ììƒ‰ íŒŒë‘ìœ¼ë¡œ í•˜ê³ 
        nowColumn.style.color = "#0000CD";
        nowRow = tbody_Calendar.insertRow(); // ìƒˆë¡œìš´ í–‰ ì¶”ê°€
      }

      if (nowDay < today) { // ì§€ë‚œë‚ ì¸ ê²½ìš°
        nowColumn.className = "pastDay";
      } else if (nowDay.getFullYear() === today.getFullYear() && nowDay.getMonth() === today.getMonth() && nowDay.getDate() === today.getDate()) { // ì˜¤ëŠ˜ì¸ ê²½ìš°
        nowColumn.className = "today";
        nowColumn.onclick = function() {
          choiceDate(this);
        };
      } else { // ë¯¸ë˜ì¸ ê²½ìš°
        nowColumn.className = "futureDay";
        nowColumn.onclick = function() {
          choiceDate(this);
        };
      }

      // ì„ íƒëœ ë‚ ì§œ ë²”ìœ„ì— í•´ë‹¹í•˜ëŠ” ìŠ¤íƒ€ì¼ ì ìš©
      if (selectedStartDate && selectedEndDate && nowDay >= selectedStartDate && nowDay <= selectedEndDate) {
        nowColumn.classList.add("choiceDay");
      } else if (selectedStartDate && !selectedEndDate && nowDay.getTime() === selectedStartDate.getTime()) {
        nowColumn.classList.add("choiceDay");
  
      }
    }
    // ì„ íƒëœ ë‚ ì§œê°€ ì—†ì„ ë•Œ Day ì´ˆê¸°í™”
    if (!selectedStartDate && !selectedEndDate) {
    	const applyButton = document.querySelector("#applyButton");
    	applyButton.style.display = 'none';
    	const info = document.querySelector(".info");
  	  info.style.display = 'block';
      const courseColorDay = document.querySelector(".course-color-day");
      courseColorDay.innerHTML = "";
      courseColorDay.style.display = 'none'
      const coursePlan = document.querySelector(".course-plan");
      coursePlan.innerHTML = ""; // ê¸°ì¡´ì˜ course-list ì´ˆê¸°í™”
      coursePlan.style.display = 'none'
      const courseButtonElement = document.querySelector(".course-button");
      courseButtonElement.innerHTML = "";
      courseButtonElement.style.display = 'none'
    }
    
  }
//ì „ì—­ ë³€ìˆ˜ë¡œ daysì™€ currentDay ì„ ì–¸
  let days;
  let currentDay = 1;

//ì ìš© ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
  function applyDate() {
	  const info = document.querySelector(".info");
	  info.style.display = 'none';
	const applyButton = document.querySelector("#applyButton");
	applyButton.style.display = 'none';
	const courseColorDay = document.querySelector(".course-color-day");
	courseColorDay.innerHTML = "";
    courseColorDay.style.display = 'block';
    const coursePlan = document.querySelector(".course-plan");
    coursePlan.innerHTML = ""; // ê¸°ì¡´ì˜ course-list ì´ˆê¸°í™”
    coursePlan.style.display = 'block';
    const courseButtonElement = document.querySelector(".course-button");
    courseButtonElement.innerHTML = "";
    courseButtonElement.style.display = 'block';
    
    
    if (selectedStartDate && selectedEndDate) {
      days = getDayDiff(selectedStartDate, selectedEndDate);
      const courseColorDay = document.querySelector(".course-color-day");
      courseColorDay.innerHTML = ""; // ê¸°ì¡´ì˜ Day ìˆ«ì ì´ˆê¸°í™”
      
      const coursePlan = document.querySelector(".course-plan");
      coursePlan.innerHTML = ""; // ê¸°ì¡´ì˜ course-list ì´ˆê¸°í™”
      
      const coursedaydiv = document.createElement("div");
      coursedaydiv.className = "course-day";
      courseColorDay.appendChild(coursedaydiv);
    // 7ê°œì˜ checkbox ìƒì„±
    for (let i = 1; i <= days; i++) {
    	
    	const courseColor = document.createElement("div");
  	  courseColor.className = "course-color-check";
  	  
  	courseColor.id = `course-color-check-${i}`; // ê³ ìœ í•œ ID ì„¤ì •
  	courseColor.style.display = i === 1 ? "flex" : "none"; // ì²« ë²ˆì§¸ dayì— í•´ë‹¹í•˜ëŠ” course-listëŠ” ë³´ì—¬ì£¼ê¸°, ë‚˜ë¨¸ì§€ëŠ” ìˆ¨ê¹€
  	  const colorh5 = document.createElement("div");
  	  const colorh5Element = document.createElement("h5");
  	  colorh5Element.textContent = 'ê²½ë¡œìƒ‰ìƒ';
  	  colorh5.appendChild(colorh5Element);
  	  courseColor.appendChild(colorh5);
  	  
    	for (let j = 1; j <= 7; j++) {
      // div ìš”ì†Œ ìƒì„±
      	const divElement = document.createElement("div");
      
      // label ìš”ì†Œ ìƒì„±
	      const labelElement = document.createElement("label");
    	  labelElement.setAttribute("for", `chk${i}-${j}`);

      // checkbox ìš”ì†Œ ìƒì„±
    	  const checkboxElement = document.createElement("input");
	      checkboxElement.setAttribute("type", "checkbox");
      	checkboxElement.setAttribute("id", `chk${i}-${j}`);
      	checkboxElement.setAttribute("name", "planColor");
      	checkboxElement.setAttribute("onclick", `handleCheckboxClick(${i}, 'chk${i}-${j}')`);
		
      	const inputcss = `
      	    #chk${i}-${j}:checked + .circle${j}::after {
      	      opacity: 1;
      	    }
      	  `;
      	  
      	  // <style> ìš”ì†Œë¥¼ ìƒì„±í•˜ì—¬ CSS ìŠ¤íƒ€ì¼ì„ ì¶”ê°€
  const styleElement = document.createElement('style');
  styleElement.innerHTML = inputcss;
  document.head.appendChild(styleElement);
      // i ìš”ì†Œ ìƒì„±
	      const iElement = document.createElement("i");
    	  iElement.classList.add(`circle${j}`);

      // label ìš”ì†Œì— checkboxì™€ i ìš”ì†Œ ì¶”ê°€
	      labelElement.appendChild(checkboxElement);
    	  labelElement.appendChild(iElement);
      
          divElement.appendChild(labelElement);
      
     	  courseColor.appendChild(divElement);
      
      	  coursePlan.appendChild(courseColor);
    	}
        
    	const daydivElement = document.createElement("div");	
        const dayElement = document.createElement("h5");
        dayElement.textContent = `Day${i}`;
        dayElement.dataset.day = i; // ë°ì´í„° ì†ì„±ìœ¼ë¡œ day ê°’ ì„¤ì •
        dayElement.addEventListener("click", function () {
          changeCurrentDay(parseInt(this.dataset.day)); // day ê°’ì„ ì •ìˆ˜ë¡œ ë³€í™˜í•˜ì—¬ ì „ë‹¬
        });
        
		daydivElement.appendChild(dayElement);
        coursedaydiv.appendChild(daydivElement);
		
        const courseList = document.createElement("div");
        courseList.className = "course-list";
        courseList.id = `course-list-${i}`; // ê³ ìœ í•œ ID ì„¤ì •
        courseList.style.display = i === 1 ? "block" : "none"; // ì²« ë²ˆì§¸ dayì— í•´ë‹¹í•˜ëŠ” course-listëŠ” ë³´ì—¬ì£¼ê¸°, ë‚˜ë¨¸ì§€ëŠ” ìˆ¨ê¹€

        // Create hidden input element for the selected date
        const inputElement = document.createElement("input");
        inputElement.type = "hidden";
        inputElement.name = "planDate";

        const currentDate = new Date(selectedStartDate);
        currentDate.setDate(currentDate.getDate() + i - 1);
        const year = currentDate.getFullYear();
        const month = leftPad(currentDate.getMonth() + 1);
        const day = leftPad(currentDate.getDate());
        const selectedDate = `${year}-${month}-${day}`;
        inputElement.value = selectedDate;

        courseList.appendChild(inputElement);

        coursePlan.appendChild(courseList);
      }
	  
      const daybuttondiv = document.createElement("div");
   	  // ë¯¸ë¦¬ë³´ê¸° ë²„íŠ¼ ìƒì„±
   	  daybuttondiv.className = "daybutton";
      const previewButton = document.createElement("button");
      previewButton.setAttribute("type", "button");
      previewButton.id = "previewButton";
      previewButton.setAttribute("onclick", "coursePreviewPopup()");
      previewButton.textContent = "ë¯¸ë¦¬ë³´ê¸°";

      // ë“±ë¡ ë²„íŠ¼ ìƒì„±
      const submitButton = document.createElement("button");
      submitButton.setAttribute("type", "button");
      submitButton.id = "insertButton";
      submitButton.setAttribute("onclick", "courseInsertPopup()");
      submitButton.textContent = "ë“±ë¡";
	  
   // ì´ì „ë‚  ë²„íŠ¼ ìƒì„±
      const previousDayButton = document.createElement("button");
      previousDayButton.type = "button";
      previousDayButton.id = "previousDayButton";
      previousDayButton.innerText = "ì´ì „ë‚ ";
      previousDayButton.addEventListener("click", previousDay);

      // ë‹¤ìŒë‚  ë²„íŠ¼ ìƒì„±
      const nextDayButton = document.createElement("button");
      nextDayButton.type = "button";
      nextDayButton.id = "nextDayButton";
      nextDayButton.innerText = "ë‹¤ìŒë‚ ";
      nextDayButton.addEventListener("click", nextDay);
      
      const courseButtonElement = document.querySelector(".course-button");
	  
      courseButtonElement.appendChild(previousDayButton);
      courseButtonElement.appendChild(nextDayButton);
      daybuttondiv.appendChild(previewButton);
      daybuttondiv.appendChild(submitButton);
      
      coursedaydiv.appendChild(daybuttondiv);
      
      // Day ìˆ«ì ì´ˆê¸° ì„¤ì • (ì²« ë²ˆì§¸ Dayë¥¼ ì„ íƒí•œ ìƒíƒœë¡œ ì„¤ì •)
      const firstDayElement = document.querySelector(".course-color-day h5");
      firstDayElement.classList.add("active");
    } else {
      const courseColorDay = document.querySelector(".course-color-day");
      courseColorDay.innerHTML = ""; // Day ìˆ«ì ì œê±°

      const coursePlan = document.querySelector(".course-plan");
      coursePlan.innerHTML = ""; // course-list ì œê±°
    }
  }

  // ë‹¤ìŒë‚  ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
  function nextDay() {
    if (currentDay < days) {
      const currentCourseList = document.getElementById(`course-list-${currentDay}`);
      const currentCourseColor = document.getElementById(`course-color-check-${currentDay}`);
      currentCourseList.style.display = "none";
      currentCourseColor.style.display = "none";
      currentDay++;

      const nextCourseList = document.getElementById(`course-list-${currentDay}`);
      const nextCourseColor = document.getElementById(`course-color-check-${currentDay}`);
      nextCourseList.style.display = "block";
      nextCourseColor.style.display = "flex";

      // Day ìˆ«ì ë³€ê²½
      const courseColorDay = document.querySelector(".course-color-day");
      const dayElements = courseColorDay.getElementsByTagName("h5");
      for (let i = 0; i < dayElements.length; i++) {
        const dayElement = dayElements[i];
        if (parseInt(dayElement.dataset.day) === currentDay) {
          dayElement.classList.add("active");
        } else {
          dayElement.classList.remove("active");
        }
      }
    }
  }

  // ì´ì „ë‚  ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë˜ëŠ” í•¨ìˆ˜
  function previousDay() {
    if (currentDay > 1) {
      const currentCourseList = document.getElementById(`course-list-${currentDay}`);
      const currentCourseColor = document.getElementById(`course-color-check-${currentDay}`);
      currentCourseList.style.display = "none";
      currentCourseColor.style.display = "none";
      currentDay--;

      const previousCourseList = document.getElementById(`course-list-${currentDay}`);
      const previousCourseColor = document.getElementById(`course-color-check-${currentDay}`);
      previousCourseList.style.display = "block";
      previousCourseColor.style.display = "flex";

      // Day ìˆ«ì ë³€ê²½
      const courseColorDay = document.querySelector(".course-color-day");
      const dayElements = courseColorDay.getElementsByTagName("h5");
      for (let i = 0; i < dayElements.length; i++) {
        const dayElement = dayElements[i];
        if (parseInt(dayElement.dataset.day) === currentDay) {
          dayElement.classList.add("active");
        } else {
          dayElement.classList.remove("active");
        }
      }
    }
  }

  // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ Day ë³€ê²½ í•¨ìˆ˜
  function changeCurrentDay(day) {
    if (day !== currentDay) {
      const currentCourseList = document.getElementById(`course-list-${currentDay}`);
      currentCourseList.style.display = "none";
      currentDay = day;

      const nextCourseList = document.getElementById(`course-list-${currentDay}`);
      nextCourseList.style.display = "block";

      // Day ìˆ«ì ë³€ê²½
      const courseColorDay = document.querySelector(".course-color-day");
      const dayElements = courseColorDay.getElementsByTagName("h5");
      for (let i = 0; i < dayElements.length; i++) {
        const dayElement = dayElements[i];
        if (parseInt(dayElement.dataset.day) === currentDay) {
          dayElement.classList.add("active");
        } else {
          dayElement.classList.remove("active");
        }
      }
    }
  }
  // í˜„ì¬ Dayì— í•´ë‹¹í•˜ëŠ” course-list ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
  function showCurrentDay() {
    const courseLists = document.querySelectorAll(".course-list");
    courseLists.forEach((courseList, index) => {
      if (index + 1 === currentDay) {
        courseList.style.display = "block";
      } else {
        courseList.style.display = "none";
      }
    });
  }
  // ë‚ ì§œ ì„ íƒ
  function choiceDate(nowColumn) {
    const selectedDay = new Date(nowMonth.getFullYear(), nowMonth.getMonth(), parseInt(nowColumn.innerText));

    if (selectedStartDate && selectedEndDate) {
      // ì´ë¯¸ ì‹œì‘ ë‚ ì§œì™€ ì¢…ë£Œ ë‚ ì§œê°€ ì„ íƒëœ ê²½ìš°
      selectedStartDate = selectedEndDate = null; // ì„ íƒëœ ë‚ ì§œ ì´ˆê¸°í™”
    } else if (selectedStartDate) {
      // ì‹œì‘ ë‚ ì§œê°€ ì´ë¯¸ ì„ íƒëœ ê²½ìš°
      if (selectedDay < selectedStartDate) {
        selectedEndDate = selectedStartDate;
        selectedStartDate = selectedDay;
      } else if (selectedDay > selectedStartDate) {
        selectedEndDate = selectedDay;
        const applyButton = document.querySelector("#applyButton");
    	applyButton.style.display = 'block';
      } else {
        selectedStartDate = null; // ì„ íƒëœ ë‚ ì§œ ì´ˆê¸°í™”
      }
    } else {
      // ì‹œì‘ ë‚ ì§œê°€ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš°
      selectedStartDate = selectedDay;
    }

    buildCalendar(); // ë‹¬ë ¥ ë‹¤ì‹œ ìƒì„±
  }
//ë‚ ì§œ ì°¨ì´ ê³„ì‚°
  function getDayDiff(startDate, endDate) {
    const oneDay = 24 * 60 * 60 * 1000; // 1ì¼ì˜ ë°€ë¦¬ì´ˆ ìˆ˜
    const diffDays = Math.round(Math.abs((startDate - endDate) / oneDay)) + 1; // ë‚ ì§œ ì°¨ì´ ê³„ì‚°
    return diffDays;
  }
  // ì´ì „ë‹¬ ë²„íŠ¼ í´ë¦­
  function prevCalendar() {
    nowMonth = new Date(nowMonth.getFullYear(), nowMonth.getMonth() - 1, nowMonth.getDate()); // í˜„ì¬ ë‹¬ì„ 1 ê°ì†Œ
    buildCalendar(); // ë‹¬ë ¥ ë‹¤ì‹œ ìƒì„±
  }

  // ë‹¤ìŒë‹¬ ë²„íŠ¼ í´ë¦­
  function nextCalendar() {
    nowMonth = new Date(nowMonth.getFullYear(), nowMonth.getMonth() + 1, nowMonth.getDate()); // í˜„ì¬ ë‹¬ì„ 1 ì¦ê°€
    buildCalendar(); // ë‹¬ë ¥ ë‹¤ì‹œ ìƒì„±
  }


	// inputê°’ì´ í•œìë¦¬ ìˆ«ìì¸ ê²½ìš° ì•ì— '0' ë¶™í˜€ì£¼ëŠ” í•¨ìˆ˜
	function leftPad(value) {
		if (value < 10) {
			value = "0" + value;
			return value;
		}
		return value;
	}
	function coursePreviewPopup() {
		  function getInputValues() {
		    const courseLists = document.querySelectorAll('.course-plan .course-list');
		    const courseColors = document.querySelectorAll('.course-plan .course-color-check');
		    let check = true;
		    let placecheck = true;
		    const values = [];

		    courseLists.forEach((courseList, index) => {
		      const inputDateElement = courseList.querySelector('input[name="planDate"]');
		      const inputLonElements = courseList.querySelectorAll('input[name="planLon"]');
		      const inputLatElements = courseList.querySelectorAll('input[name="planLat"]');
  			  const inputColor = courseColors[index].querySelector('input[type="checkbox"]:checked');
	     	  let checkboxColor = getCheckboxIconBackgroundColor(inputColor);
	     	  if(checkboxColor === false){
	     		  check = false;
	     		  return check;
	     	  }else{
	     		  check = true;
	     	  }
	     	  
		      const colorName = convertRGBToColorName(checkboxColor);
		      
		      const inputDateValue = inputDateElement.value;
		      const lonLatPairs = [];
			  
		      inputLonElements.forEach((inputLonElement, lonIndex) => {
		        const inputLatElement = inputLatElements[lonIndex];

		        const inputLonValue = inputLonElement.value;
		        const inputLatValue = inputLatElement.value;
		        
		        lonLatPairs.push({
		          lon: inputLonValue,
		          lat: inputLatValue
		        });
				
		      });

		      values.push({
		        index: index + 1,
		        date: inputDateValue,
		        lonLatPairs: lonLatPairs,
		        color: colorName
		      });
		     });
		    values.forEach((values, index) => {
		    	const lon = values.lonLatPairs;
		    	console.log("test : "+lon);
				if(lon.length == 0){
					let placecheck = false;
					return placecheck;
				}else{
					let placecheck = true;
				}
		    });
			
		    console.log("placecheck : "+placecheck);
		    console.log("check : "+check);
		    if(!check){
	     		 alert('ë‚ ì§œë³„ ìƒ‰ìƒì„ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”');
	     		  return false;
	     	  }
		    if(!placecheck){
		    	alert('ë‚ ì§œë³„ ì¥ì†Œë¥¼ ëª¨ë‘ ì„ íƒí•´ ì£¼ì„¸ìš”');
		    	return false;
		    }
		    return values;
		  }
		  
		  const inputValues = getInputValues();
		  if(!inputValues || inputValues.length == 0){
     		  return false;
     	  }

		  previewOpenPopup(inputValues);

		 }
		
	function courseInsertPopup() {
		  function getInputValues() {
		    const courseLists = document.querySelectorAll('.course-plan .course-list');
		    const courseColors = document.querySelectorAll('.course-plan .course-color-check');
		    let check = true;
		    let placecheck = true;
		    const values = [];

		    courseLists.forEach((courseList, index) => {
		      const inputDateElement = courseList.querySelector('input[name="planDate"]');
		      const inputLonElements = courseList.querySelectorAll('input[name="planLon"]');
		      const inputLatElements = courseList.querySelectorAll('input[name="planLat"]');
			  const inputColor = courseColors[index].querySelector('input[type="checkbox"]:checked');
	     	  const checkboxColor = getCheckboxIconBackgroundColor(inputColor);
	    	  if(checkboxColor === false){
	     		  check = false;
	     		  return check;
	     	  }else{
	     		  check = true;
	     	  }
		      const colorName = convertRGBToColorName(checkboxColor);
		      
		      const inputDateValue = inputDateElement.value;
		      const lonLatPairs = [];
			  
		      inputLonElements.forEach((inputLonElement, lonIndex) => {
		        const inputLatElement = inputLatElements[lonIndex];

		        const inputLonValue = inputLonElement.value;
		        const inputLatValue = inputLatElement.value;
		        
		        lonLatPairs.push({
		          lon: inputLonValue,
		          lat: inputLatValue
		        });
		      });
					
		      values.push({
		        index: index + 1,
		        date: inputDateValue,
		        lonLatPairs: lonLatPairs,
		        color: colorName
		      });
		      
		      });
		    if(!check){
	     		 alert('ë‚ ì§œë³„ ìƒ‰ìƒì„ ì„ íƒí•´ ì£¼ì„¸ìš”');
	     		  return false;
	     	  }
		    return values;
		  }
		  
		  const inputValues = getInputValues();

		  insertOpenPopup(inputValues);

		 }
	
	function handleCheckboxClick(day, checkboxId) {
			const courseColorCheck = document.querySelector(`#course-color-check-${day}`);
			  if (courseColorCheck.style.display === 'flex') {
			    const checkboxes = courseColorCheck.querySelectorAll('input[type="checkbox"]');
			    checkboxes.forEach((checkbox) => {
			      if (checkbox.id === checkboxId) {
			        checkbox.checked = true;
			      } else {
			        checkbox.checked = false;
			      }
			    });	
			}
		  }
	function getCheckboxIconBackgroundColor(checkboxElement) {
		if(checkboxElement === "" || checkboxElement === null){
			return false;
		}else{
		  const labelElement = checkboxElement.parentElement; // ì²´í¬ë°•ìŠ¤ë¥¼ ê°ì‹¸ëŠ” label ìš”ì†Œ
		  const iconElement = labelElement.querySelector('i'); // label ìš”ì†Œ ë‚´ì˜ i íƒœê·¸

		  const computedStyle = window.getComputedStyle(iconElement);
		  const backgroundColor = computedStyle.backgroundColor;

		  return backgroundColor;
		}
	}	
	function convertRGBToColorName(rgbValue) {
		const colorMap = {
				  'rgb(255, 0, 0)': 'red',
				  'rgb(255, 165, 0)': 'orange',
				  'rgb(255, 255, 0)': 'yellow',
				  'rgb(0, 128, 0)': 'green',
				  'rgb(0, 0, 255)': 'blue',
				  'rgb(0, 0, 128)': 'navy',
				  'rgb(128, 0, 128)': 'purple',
				  // ì¶”ê°€ì ì¸ ìƒ‰ìƒ ê°’ë“¤ì„ í•„ìš”ì— ë”°ë¼ ê³„ì†í•´ì„œ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
				};

		  return colorMap[rgbValue] || rgbValue;
		}
	
	function courseInsert(){
		function getInputValues() {
		    const courseLists = document.querySelectorAll('.course-plan .course-list');
		    const courseColors = document.querySelectorAll('.course-plan .course-color-check');
		    let check = true;
		    let placecheck = true;
		    const values = [];

		    courseLists.forEach((courseList, index) => {
		      const inputDateElement = courseList.querySelector('input[name="planDate"]');
		      const inputLonElements = courseList.querySelectorAll('input[name="planLon"]');
		      const inputLatElements = courseList.querySelectorAll('input[name="planLat"]');
  			  const inputColor = courseColors[index].querySelector('input[type="checkbox"]:checked');
	     	  const checkboxColor = getCheckboxIconBackgroundColor(inputColor);
	    	  if(checkboxColor === false){
	     		  check = false;
	     		  return check;
	     	  }else{
	     		  check = true;
	     	  }
		      const colorName = convertRGBToColorName(checkboxColor);
		      
		      const inputDateValue = inputDateElement.value;
		      const lonLatPairs = [];
			  
		      inputLonElements.forEach((inputLonElement, lonIndex) => {
		        const inputLatElement = inputLatElements[lonIndex];

		        const inputLonValue = inputLonElement.value;
		        const inputLatValue = inputLatElement.value;
		        
		        lonLatPairs.push({
		          lon: inputLonValue,
		          lat: inputLatValue
		        });
		      });
					
		      values.push({
		        index: index + 1,
		        date: inputDateValue,
		        lonLatPairs: lonLatPairs,
		        color: colorName
		      });
		    });
		    if(!check){
	     		 alert('ë‚ ì§œë³„ ìƒ‰ìƒì„ ì„ íƒí•´ ì£¼ì„¸ìš”');
	     		  return false;
	     	  }
		    return values;
		  }
		
 		const inputValues = getInputValues();
		const planName = document.querySelector('input[name="planName"]');
		const planNameValue = planName.value;
		if(planNameValue == "" || planNameValue == null){
			alert("ì¼ì • ì œëª©ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”");
			return false;
		}else{
			$.ajax({
			    url: '/plan/createplan',
			    type: 'POST',
			    data: JSON.stringify({
			    	   inputValues: inputValues,
			    	   userID: loginchk,
			    	   planName: planNameValue
			    	}),
			    contentType: 'application/json',
			    success: function(data) {
			      location.href="/login/usermain";
			    },
			    error: function(data){
			    	alert("ì¼ì •ì´ ì™„ì„± ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤");
			    }
			  });	
		}
		   
	}
	
	function search(){
		const searchInput = document.querySelector('input[name="keyword"]');
		const keyword = encodeURIComponent(searchInput.value);
		
		$.ajax({
			url:'/plan/search',
			type: 'POST',
			data: {keyword: keyword,
				   pageNum: pageNum},
			success: function(data){
				updateList(data.placeList);
		    	createMarkers(data.placeList);
				updatePaginationsearch(data.totalPages, data.currentPage, keyword);
				
			},
			error: function(data){
				alert("ì‹¤íŒ¨");
			}
		});
	}
	
	function updatePagination(totalPages, currentPage) {
	    var paginationContainer = document.querySelector('#pagination');
	    paginationContainer.innerHTML = ''; // ê¸°ì¡´ í˜ì´ì§€ ë²ˆí˜¸ ì´ˆê¸°í™”
	    var category = document.querySelector('input[name="placeCategory"]').value;
	    var pageRange = 5; // í•œ ë²ˆì— í‘œì‹œí•  í˜ì´ì§€ ë²ˆí˜¸ì˜ ìˆ˜
	    var startPage = Math.max(1, currentPage - Math.floor(pageRange / 2));
	    var endPage = Math.min(totalPages, startPage + pageRange - 1);

	    // í˜ì´ì§€ ë²ˆí˜¸ ìƒì„±
	    for (var i = startPage; i <= endPage; i++) {
	        var pageLink = document.createElement('a');
	        pageLink.href = 'javascript:void(0)';
	        pageLink.textContent = i;
	        pageLink.addEventListener('click', function () {
	        	fetchUpdatedMarkers(category, Number(this.textContent));
	        });

	        if (i === currentPage) {
	            pageLink.classList.add('pagination-active');
	        }

	        paginationContainer.appendChild(pageLink);
	    }

	}


	function updatePaginationsearch(totalPages, currentPage, keyword) {
	    var paginationContainer = document.querySelector('#pagination');
	    paginationContainer.innerHTML = ''; // ê¸°ì¡´ í˜ì´ì§€ ë²ˆí˜¸ ì´ˆê¸°í™”
	    var pageRange = 5; // í•œ ë²ˆì— í‘œì‹œí•  í˜ì´ì§€ ë²ˆí˜¸ì˜ ìˆ˜
	    var startPage = Math.max(1, currentPage - Math.floor(pageRange / 2));
	    var endPage = Math.min(totalPages, startPage + pageRange - 1);
	    var decodekeyword = decodeURIComponent(keyword);
		console.log(decodekeyword);
	    // í˜ì´ì§€ ë²ˆí˜¸ ìƒì„±
	    for (var i = startPage; i <= endPage; i++) {
	        var pageLink = document.createElement('a');
	        pageLink.href = 'javascript:void(0)';
	        pageLink.textContent = i;
	        pageLink.addEventListener('click', function () {
	        	fetchUpdatedMarkerssearch(decodekeyword, Number(this.textContent));
	        });

	        if (i === currentPage) {
	            pageLink.classList.add('pagination-active');
	        }

	        paginationContainer.appendChild(pageLink);
	    }

	}

	document.addEventListener('DOMContentLoaded', function() {
		  const buttons = document.querySelectorAll('#category-button button');
		  let selectedButton = document.querySelector('.button-selected');

		  buttons.forEach(button => {
		    button.addEventListener('click', function() {
		      const isSelected = this.classList.contains('button-selected');

		      if (!isSelected) {
		        // ë‹¤ë¥¸ ë²„íŠ¼ë“¤ì˜ ì„ íƒ ìƒíƒœ ì œê±°
		        buttons.forEach(btn => {
		          btn.classList.remove('button-selected');
		        });

		        // í˜„ì¬ ë²„íŠ¼ì„ ì„ íƒ ìƒíƒœë¡œ ì„¤ì •
		        this.classList.add('button-selected');
		        selectedButton = this;
		      }
		    });
		  });
		});
	
	window.onload = function () {
		  buildCalendar();
		  initTmap();
		  fetchUpdatedMarkers('restaurant', 1);
	};	
</script>
<title>Insert title here</title>
</head>
<body>
	<div class="header">
		<div class="header-category">
			<div class="header-left">
				<a href="/course/recommandcourse" id="label-left-course">ì½”ìŠ¤ì¶”ì²œ</a> 
				<a href="/community/communitymain" id="label-left-community">ì»¤ë®¤ë‹ˆí‹°</a>
				<a href="/chatting" id="label-left-chat">ì±„íŒ…ë°©</a>
			</div>
			<div class="header-center">
				<a href="/"><img src="./resources/image/logo.png" alt="" id="logimg"></a>
			</div>
			<!-- ë¡œê·¸ì¸ì „ -->
			<div class="header-right" th:if="${session.login == null}">
				<a href="/login" id="label-right-login">ë¡œê·¸ì¸</a> 
				<a href="/login/registerform" id="label-right-login">íšŒì›ê°€ì…</a>
			</div>
			<!-- ë¡œê·¸ì¸ í›„ -->
			<div class="header-right" th:if="${session.login != null}">
				<a href="/login/logout" id="label-right-login">ë¡œê·¸ì•„ì›ƒ</a> 
				<a href="/login/usermain" id="label-right-register">ë§ˆì´í˜ì´ì§€</a>
			</div>
		</div>
	</div>
	<div class="main"> 
		<div class="main-left">
			<div class="search-div">
				<input type="text" id="search" name="keyword" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
				<button type="button" id="search-button" name="searchbutton" onclick="search()"><img src="/resources/image/plan_dotbogi.png"></button>
			</div>
			<div class="list-scroll">
			<div class="list">
				<div id="left_block" th:each="restaurant : ${placeRestaurantList}">
				<input type="hidden" name="placeCategory" th:value="${restaurant.placeCategory}">
					<div id="list-img">
						<img th:src="@{/resources/image/place/__${restaurant.placeName}__.jpg}" alt="">
					</div>
					<div id="list-name">
						<div id="list-name-label">
							<label th:text="${restaurant.placeName}">ê³½ì§€ì‹ë‹¹</label>
						</div>
						<div id="list-name-heartimg">
							<div>
								<img src="/resources/image/insta_heart.png" alt="" id="heartimg">
							</div>
							<div id="list-name-heartimg-label">
								<label th:text="${restaurant.placeGood}">456</label>
							</div>
						</div>
					</div>
					<div id="list-plus">
						<img src="./resources/image/plus.png" alt="" id="plus">
					</div>
					<input type="hidden" name="planLon" th:value="${restaurant.placeLon}">
					<input type="hidden" name="planLat" th:value="${restaurant.placeLat}">
				</div>
			</div>
			</div>
			<div id="pagination"></div>
		</div>
		<div class="placemenu" style="display: none;">
			<div id="placemenu_top">
				<div id="placemenu_button">
					<button>x</button>
				</div>
				<div id="datatest">
				  <img id="placeImage" src="" alt="ì¥ì†Œ ì´ë¯¸ì§€">
				</div>
				<div id="datatest1"></div>
				<div id="ocr_button">
					<img src="/resources/image/insta_heart.png" id="heartimg2"/>
					<div id="datatest4"></div>
					<img src="/resources/image/goood.png" id="heartimg2"/>
					<div id="placemenu_heart">
					<a th:href="'javascript:void(0);'" th:onclick="|openPopup()|">ì¶”ì²œí•˜ê¸°</a>
					</div>
				</div>
				<hr id="hr_css">
				<div id="placemenu_pin">
					<img src="/resources/image/pin2.png" id="pin_img"/>
					<div id="datatest2"></div>
				</div>
				<div id="placemenu_number">
					<img src="/resources/image/number.png" id="pin_img"/>
					<div id="datatest3"></div>
				</div>
				<div id="placemenu_number">
					<img src="/resources/image/infocheck.png" id="pin_img"/>
					<div id="datatest5"></div>
				</div>
				<div id="placemenu_number">
					<img src="/resources/image/taaag.png" id="pin_img"/>
					<div id="data_tag">
						<div id="datatest6"></div>
						<div id="datatest7"></div>
						<div id="datatest8"></div>
					</div>
				</div>
				<div id="datatest0"></div>
				<div id="chart_title">ì—°ë ¹ë³„/ì„±ë³„ ì¶”ì²œ ë¹„ìœ¨</div>	
			</div>
			<div id="chart_set">
				<div id="chart">
					<canvas id="chartCanvas"></canvas>
				</div>
				<div id="chart2">
					<canvas id="chartCanvas2"></canvas>
				</div>
			</div>
		</div>
		<div class="main-center">
			<div id="map_div"></div>
			
			<div id="category-button">
				<button id="restaurant-btn" class="button-selected">ìŒì‹ì </button>
				<button id="youtube-btn">ìœ íŠœë¸Œë§›ì§‘</button>
				<button id="tourist-btn">ê´€ê´‘ì§€</button>
				<button id="hill-btn">ì˜¤ë¦„</button>
				<button id="ollegil-btn">ì˜¬ë ˆê¸¸</button>
			</div>
			<div id="weather">
			<div th:if="${not #lists.isEmpty(jeju) or jeju != null}">
				<div id="jejuweather">
					<div id="wether-current">
						<h5>ì œì£¼ì‹œ</h5>
						<h2>[[${jeju.currenttemp}]]â„ƒ</h2>
					</div>
					<div id="wether-temp">
						<div id="wether-state">
							<div th:if="${jeju.sky == 1 && jeju.pty == 0}" >
								<div th:if="${jeju.day == 'day'}">
									<h5>ë§‘ìŒ(ë‚®)</h5>
									<img id="weatherImg" alt="" src="/resources/image/weather/clearday.png">
								</div>
								<div th:if="${jeju.day == 'night'}">
									<h5>ë§‘ìŒ(ë°¤)</h5>
									<img id="weatherImg" alt="" src="/resources/image/weather/clearnight.png">
								</div>
							</div>
							<div th:if="${jeju.sky == 3 && jeju.pty == 0}" >
								<h5>íë¦¼</h5>
								<img id="weatherImg" alt="" src="/resources/image/weather/cloud.png">
							</div>
							<div th:if="${jeju.sky == 4 && jeju.pty == 0}" >
								<div th:if="${jeju.day == 'day'}">
									<h5>êµ¬ë¦„ë§ìŒ(ë‚®)</h5>
									<img id="weatherImg" alt="" src="/resources/image/weather/cloudyday.png">
								</div>
								<div th:if="${jeju.day == 'night'}">
									<h5>êµ¬ë¦„ë§ìŒ(ë°¤)</h5>
									<img id="weatherImg" alt="" src="/resources/image/weather/cloudynight.png">
								</div>
							</div>
							<div th:if="${jeju.sky == 4 && jeju.pty == 1}" >
								<h5>ë¹„</h5>
								<img id="weatherImg" alt="" src="/resources/image/weather/rain.png">
							</div>
							<div th:if="${jeju.sky == 4 && jeju.pty == 3}" >
								<h5>ëˆˆ</h5>
								<img id="weatherImg" alt="" src="/resources/image/weather/snow.png">
							</div>
							
							<div id="wether-temp">
								<h5>ìµœì €:[[${jeju.minimumtemp}]]â„ƒ</h5>
								<h5>ìµœê³ :[[${jeju.highesttemp}]]â„ƒ</h5>
							</div>
						</div>
						
					</div>
				</div>
				</div>
				<div th:if="${#lists.isEmpty(jeju) or jeju == null}"></div>
				<div th:if="${not #lists.isEmpty(seogwipo) or seogwipo != null}">
				<div id="seogwipoweather">
					<div id="wether-current">
						<h5>ì„œê·€í¬ì‹œ</h5>
						<h2>[[${seogwipo.currenttemp}]]â„ƒ</h2>
					</div>
					<div id="wether-temp">
						<div id="wether-state">
							<div th:if="${seogwipo.sky == 1 && seogwipo.pty == 0}" >
								<div th:if="${seogwipo.day == 'day'}">
									<h5>ë§‘ìŒ(ë‚®)</h5>
									<img id="weatherImg" alt="" src="/resources/image/weather/clearday.png">
								</div>
								<div th:if="${seogwipo.day == 'night'}">
									<h5>ë§‘ìŒ(ë°¤)</h5>
									<img id="weatherImg" alt="" src="/resources/image/weather/clearnight.png">
								</div>
							</div>
							<div th:if="${seogwipo.sky == 3 && seogwipo.pty == 0}" >
								<h5>íë¦¼</h5>
								<img id="weatherImg" alt="" src="/resources/image/weather/cloud.png">
							</div>
							<div th:if="${seogwipo.sky == 4 && seogwipo.pty == 0}" >
								<div th:if="${seogwipo.day == 'day'}">
									<h5>êµ¬ë¦„ë§ìŒ(ë‚®)</h5>
									<img id="weatherImg" alt="" src="/resources/image/weather/cloudyday.png">
								</div>
								<div th:if="${seogwipo.day == 'night'}">
									<h5>êµ¬ë¦„ë§ìŒ(ë°¤)</h5>
									<img id="weatherImg" alt="" src="/resources/image/weather/cloudynight.png">
								</div>
							</div>
							<div th:if="${seogwipo.sky == 4 && seogwipo.pty == 1}" >
								<h5>ë¹„</h5>
								<img id="weatherImg" alt="" src="/resources/image/weather/rain.png">
							</div>
							<div th:if="${seogwipo.sky == 4 && seogwipo.pty == 3}" >
								<h5>ëˆˆ</h5>
								<img id="weatherImg" alt="" src="/resources/image/weather/snow.png">
							</div>
							
							<div id="wether-temp">
								<h5>ìµœì €:[[${seogwipo.minimumtemp}]]â„ƒ</h5>
								<h5>ìµœê³ :[[${seogwipo.highesttemp}]]â„ƒ</h5>
							</div>
						</div>
						</div>
					</div>
				</div>
				<div th:if="${#lists.isEmpty(seogwipo) or seogwipo == null}">
				</div>
			</div>
		</div>
		<div class="main-right">
			<div class="calendar">
				<table class="Calendar-table">
					<thead>
						<tr>
							<td onClick="prevCalendar();" style="cursor: pointer;">&#60;</td>
							<td colspan="5"><span id="calYear"></span>ë…„ <span
								id="calMonth"></span>ì›”</td>
							<td onClick="nextCalendar();" style="cursor: pointer;">&#62;</td>
						</tr>
						<tr>
							<td>ì¼</td>
							<td>ì›”</td>
							<td>í™”</td>
							<td>ìˆ˜</td>
							<td>ëª©</td>
							<td>ê¸ˆ</td>
							<td>í† </td>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
				<div>
					<button type="button" id="applyButton" th:onclick="applyDate()" style="display: none">ì ìš©</button>
				</div>
			</div>
			<div class="course">
				<div class="info" style="display: block">
<pre>                 ì¼ì • ë“±ë¡ ë°©ë²•<br>
1. ì²«ë‚ ê³¼ ë§ˆì§€ë§‰ë‚  ë‚ ì§œ ì„ íƒ í›„ ì ìš© ë²„íŠ¼ í´ë¦­<br>
2. Dayë³„ë¡œ ìƒ‰ìƒ ì„ íƒí›„ ì™¼ìª½ ë¦¬ìŠ¤íŠ¸ì—ì„œ 
   í”ŒëŸ¬ìŠ¤ ë²„íŠ¼ ì´ìš©í•´ ì¥ì†Œ ì¶”ê°€ ê°€ëŠ¥<br>
3. ì˜¤ë¥¸ìª½ ì¼ì •ì—ì„œ ë§ˆì´ë„ˆìŠ¤ ë²„íŠ¼ ì´ìš©í•´
   ì¥ì†Œ ì œê±° ê°€ëŠ¥<br>
4. ì´ì „ë‚  ë‹¤ìŒë‚  ë²„íŠ¼ìœ¼ë¡œ Dayë³„ë¡œ ì´ë™ ê°€ëŠ¥<br>
5. ë¯¸ë¦¬ë³´ê¸° í´ë¦­ì‹œ Dayë³„ë¡œ ê²½ë¡œ ë³´ì—¬ì£¼ê¸°<br>
6. ë“±ë¡ í´ë¦­ì‹œ Dayë³„ ê²½ë¡œ ë³´ì—¬ì£¼ê³ 
   ì €ì¥í•  ì´ë¦„ ì‘ì„±í›„ ë“±ë¡í•˜ë©´ ì¼ì • ìƒì„±
				</pre>
				</div>
				<div class="course-color-day">
				</div>
				<div class="course-plan">
					<div class="course-color-check">
					</div>
				</div>
				<div class="course-button">
				</div>
			</div>
		</div>
	</div>
	<div id="previewPopupContainer" class="preview-popup-container" style="display: none">
  		<div class="preview-popup-content">
    <!-- íŒì—… ë‚´ìš© -->
    		<div id="preivew_button_container">
    		</div>
			<div id="preview_div"></div>
  	</div>
  	</div>
  	<div id="insertPopupContainer" class="insert-popup-container" style="display: none">
  		<div class="insert-popup-content">
    <!-- íŒì—… ë‚´ìš© -->
    		<div id="input_button_container">
    		</div>
			<div id="insert_div"></div>
  	</div>
</div>
	
</body>
<script th:inline="javascript">
var new_polyLine = [];
var new_Click_polyLine = [];
var markerList = [];
var pointArray = [];
var markers2 = [];

function previewOpenPopup(inputValues) {
	  var previewPopupContainer = document.getElementById('previewPopupContainer');
	// íŒì—… ë‚´ìš© ì„¤ì •
	  var previewPopupContent = previewPopupContainer.querySelector('.preview-popup-content');
	  var preivewMapContainer = previewPopupContent.querySelector('#preview_div');
	  preivewMapContainer.innerHTML="";
	  previewPopupContainer.style.display = 'block';
	  
	  previewTmap();
	  createPreviewButton(inputValues);
	  showAllDayRoute(inputValues);
	}

	function preivewClosePopup() {
	  var previewPopupContainer = document.getElementById('previewPopupContainer');
	  previewPopupContainer.style.display = 'none';
	}
	
	function insertOpenPopup(inputValues) {
		  var insertPopupContainer = document.getElementById('insertPopupContainer');
		// íŒì—… ë‚´ìš© ì„¤ì •
		  var insertPopupContent = insertPopupContainer.querySelector('.insert-popup-content');
		  var insertMapContainer = insertPopupContent.querySelector('#insert_div');
		  insertMapContainer.innerHTML="";
		  insertPopupContainer.style.display = 'block';
		  
		  insertTmap();
		  createInsertButton(inputValues);
		  showAllDayRoute(inputValues);
		}

		function insertClosePopup() {
		  var insertPopupContainer = document.getElementById('insertPopupContainer');
		  insertPopupContainer.style.display = 'none';
		}

		function createPreviewButton(inputValues){
		// ë²„íŠ¼ì„ ì¶”ê°€í•  ì»¨í…Œì´ë„ˆ ì„ íƒ
		 var previewPopupContainer = document.getElementById('previewPopupContainer');
		var previewPopupContent = previewPopupContainer.querySelector('.preview-popup-content');
		 var previewButtonContainer = previewPopupContent.querySelector('#preivew_button_container');
		 previewButtonContainer.innerHTML="";
		 
		 var closeButtonDiv = document.createElement("div");
		 closeButtonDiv.className = "close-Button-div";
		 var previewdayButtonDiv = document.createElement("div");
		 previewdayButtonDiv.className = "preview-day-button-div";
		 
			var inputCloseButton = document.createElement('button');
			inputCloseButton.textContent = 'X';
			inputCloseButton.addEventListener('click', preivewClosePopup);
			closeButtonDiv.appendChild(inputCloseButton);
			previewButtonContainer.appendChild(closeButtonDiv);
			
		var AllDaybutton = document.createElement('button');
		AllDaybutton.textContent = 'All Day';

		AllDaybutton.id ="input_button_container_allDayButton";
		previewButtonContainer.appendChild(AllDaybutton);

		AllDaybutton.className = 'preview-day-button-selected';
		previewdayButtonDiv.appendChild(AllDaybutton);
		previewButtonContainer.appendChild(previewdayButtonDiv);
		AllDaybutton.addEventListener('click', function() {
			  showAllDayRoute(inputValues);
			});
			


		for (var i = 0; i < inputValues.length; i++) {
		    var daybutton = document.createElement('button');
		    daybutton.textContent = 'Day ' + (i + 1);
		    daybutton.id = "input_button_container_dayButton";
		    previewButtonContainer.appendChild(daybutton);
		    previewdayButtonDiv.appendChild(daybutton);
			previewButtonContainer.appendChild(previewdayButtonDiv);
		    
		    // í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
		    daybutton.addEventListener('click', function(event) {
		    	var buttons = Array.from(previewdayButtonDiv.getElementsByTagName('button'));
	              var buttonIndex = buttons.indexOf(event.target);
		      var selectedInputValue = inputValues[buttonIndex - 1];
		      console.log('Button ' + (buttonIndex + 2) + ' clicked');
		      console.log('Selected Input Value:', selectedInputValue);
		      // ê²½ë¡œ í‘œì‹œë¥¼ ìœ„í•œ ë°ì´í„° ì¶”ì¶œ
		      var date = selectedInputValue.date;
		      var color = selectedInputValue.color;
		      var lonLatPairs = selectedInputValue.lonLatPairs;
		      // ê²½ë¡œ í‘œì‹œ ë¡œì§ ì¶”ê°€
		      clearMarkers()
		      clearRoutes(); // ê¸°ì¡´ì˜ ê²½ë¡œ ì‚­ì œ
		      drawRoute(date, lonLatPairs, color);
		    });
		}
		  const buttons = document.querySelectorAll('.preview-day-button-div button');
		  console.log("test buttons : "+buttons);
		  let selectedButton = document.querySelector('.preview-day-button-selected');
		  
		  buttons.forEach(button => {
		    button.addEventListener('click', function() {
		      const isSelected = this.classList.contains('preview-day-button-selected');

		      if (!isSelected) {
		        // ë‹¤ë¥¸ ë²„íŠ¼ë“¤ì˜ ì„ íƒ ìƒíƒœ ì œê±°
		        buttons.forEach(btn => {
		          btn.classList.remove('preview-day-button-selected');
		        });

		        // í˜„ì¬ ë²„íŠ¼ì„ ì„ íƒ ìƒíƒœë¡œ ì„¤ì •
		        this.classList.add('preview-day-button-selected');
		        selectedButton = this;
		      }
		    });
		  });
		}

		function createInsertButton(inputValues){
			// ë²„íŠ¼ì„ ì¶”ê°€í•  ì»¨í…Œì´ë„ˆ ì„ íƒ
			 var inputPopupContainer = document.getElementById('insertPopupContainer');
			var inputPopupContent = inputPopupContainer.querySelector('.insert-popup-content');
			 var inputButtonContainer = inputPopupContent.querySelector('#input_button_container');
			 inputButtonContainer.innerHTML="";
			 var closeButtonDiv = document.createElement("div");
			 closeButtonDiv.className = "close-Button-div";
			 var dayButtonDiv = document.createElement("div");
			 dayButtonDiv.className = "insert-day-button-div";
				var inputCloseButton = document.createElement('button');
				inputCloseButton.textContent = 'X';
				inputCloseButton.addEventListener('click', insertClosePopup);
				closeButtonDiv.appendChild(inputCloseButton);
				inputButtonContainer.appendChild(closeButtonDiv);
				inputButtonContainer.appendChild(dayButtonDiv);
			 
			var AllDaybutton = document.createElement('button');
			AllDaybutton.textContent = 'All Day';
			AllDaybutton.id ="input_button_container_allDayButton";
			AllDaybutton.className = 'insert-day-button-selected';
			AllDaybutton.addEventListener('click', function() {
				  showAllDayRoute(inputValues);
				});
			dayButtonDiv.appendChild(AllDaybutton);
			inputButtonContainer.appendChild(dayButtonDiv);
			for (var i = 0; i < inputValues.length; i++) {
			    var daybutton = document.createElement('button');
			    daybutton.textContent = 'Day ' + (i + 1);
			    daybutton.id = "input_button_container_dayButton";
			    dayButtonDiv.appendChild(daybutton);
			    inputButtonContainer.appendChild(dayButtonDiv);
			    
			    // í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
			    daybutton.addEventListener('click', function(event) {
			    	var buttons = Array.from(dayButtonDiv.getElementsByTagName('button'));
		              var buttonIndex = buttons.indexOf(event.target);
			      var selectedInputValue = inputValues[buttonIndex - 1];
			      console.log('Button ' + (buttonIndex + 1) + ' clicked');
			      console.log('Selected Input Value:', selectedInputValue);
			      // ê²½ë¡œ í‘œì‹œë¥¼ ìœ„í•œ ë°ì´í„° ì¶”ì¶œ
			      var date = selectedInputValue.date;
			      var color = selectedInputValue.color;
			      var lonLatPairs = selectedInputValue.lonLatPairs;
			      // ê²½ë¡œ í‘œì‹œ ë¡œì§ ì¶”ê°€
			      clearMarkers()
			      clearRoutes(); // ê¸°ì¡´ì˜ ê²½ë¡œ ì‚­ì œ
			      drawRoute(date, lonLatPairs, color);
			    });
			}
		    const courseNameInput = document.createElement("input");
		    courseNameInput.type = "text";
		    courseNameInput.name = "planName";
		    courseNameInput.id = "planName";
		    courseNameInput.placeholder = 'ì œëª©';
		    const couseInsertInput = document.createElement("button");
		    couseInsertInput.type ="button";
		    couseInsertInput.id ="courseInsertButton";
		    couseInsertInput.setAttribute("onclick", "courseInsert()");
		    couseInsertInput.textContent = "ë“±ë¡";
		    
		    inputButtonContainer.appendChild(couseInsertInput);
		    inputButtonContainer.appendChild(courseNameInput);
			
				  const buttons = document.querySelectorAll('.insert-day-button-div button');
				  let selectedButton = document.querySelector('.insert-day-button-selected');
				  
				  buttons.forEach(button => {
				    button.addEventListener('click', function() {
				      const isSelected = this.classList.contains('insert-day-button-selected');

				      if (!isSelected) {
				        // ë‹¤ë¥¸ ë²„íŠ¼ë“¤ì˜ ì„ íƒ ìƒíƒœ ì œê±°
				        buttons.forEach(btn => {
				          btn.classList.remove('insert-day-button-selected');
				        });

				        // í˜„ì¬ ë²„íŠ¼ì„ ì„ íƒ ìƒíƒœë¡œ ì„¤ì •
				        this.classList.add('insert-day-button-selected');
				        selectedButton = this;
				      }
				    });
				  });
			}
function drawData(data, color){
	// ì§€ë„ìœ„ì— ì„ ì€ ë‹¤ ì§€ìš°ê¸°
	routeData = data;
	var resultStr = "";
	var distance = 0;
	var idx = 1;
	var newData = [];
	var equalData = [];
	var pointId1 = "-1234567";
	var ar_line = [];
	
	
	for (var i = 0; i < data.features.length; i++) {
		var feature = data.features[i];
		//ë°°ì—´ì— ê²½ë¡œ ì¢Œí‘œ ì €ì¥
		if(feature.geometry.type == "LineString"){
			ar_line = [];
			for (var j = 0; j < feature.geometry.coordinates.length; j++) {
				var startPt = new Tmapv2.LatLng(feature.geometry.coordinates[j][1],feature.geometry.coordinates[j][0]);
				ar_line.push(startPt);
				pointArray.push(feature.geometry.coordinates[j]);
			}
			var polyline = new Tmapv2.Polyline({
		        path: ar_line,
		        strokeColor: color, 
		        strokeWeight: 3,
		        map: map2
		    });
			new_polyLine.push(polyline);
		}
		var pointId2 = feature.properties.viaPointId;
		if (pointId1 != pointId2) {
			equalData = [];
			equalData.push(feature);
			newData.push(equalData);
			pointId1 = pointId2;
		}
		else {
			equalData.push(feature);
		}
	}
	geoData = newData;
	var markerCnt = 1;
	for (var i = 0; i < newData.length; i++) {
		var mData = newData[i];
		var type = mData[0].geometry.type;
		var pointType = mData[0].properties.pointType;
		var pointTypeCheck = false; // ê²½ìœ ì§€ ì¼ë•Œë§Œ true
		if (mData[0].properties.pointType == "S") {
			var img = 'http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_s.png';
			var lon = mData[0].geometry.coordinates[0];
			var lat = mData[0].geometry.coordinates[1];
		}
		else if (mData[0].properties.pointType == "E") {
			var img = 'http://tmapapi.sktelecom.com/upload/tmap/marker/pin_r_m_e.png';
			var lon = mData[0].geometry.coordinates[0];
			var lat = mData[0].geometry.coordinates[1];
		}
		else {
			markerCnt=i;
			var lon = mData[0].geometry.coordinates[0];
			var lat = mData[0].geometry.coordinates[1];
		}	
	}
}



function clearRoutes() {
    if (new_polyLine.length > 0) {
        for (var i = 0; i < new_polyLine.length; i++) {
            new_polyLine[i].setMap(null);
        }
        new_polyLine = [];
    }
    if (new_Click_polyLine.length > 0) {
        for (var i = 0; i < new_Click_polyLine.length; i++) {
            new_Click_polyLine[i].setMap(null);
        }
        new_Click_polyLine = [];
    }
}
function clearMarkers() {
	  for (var i = 0; i < markers2.length; i++) {
	    markers2[i].setMap(null);
	  }
	  markers2 = [];
	}
function showAllDayRoute(inputValues) {
	  // ê¸°ì¡´ ë§ˆì»¤ ì§€ìš°ê¸°
	  clearMarkers();
for (var i = 0; i < inputValues.length; i++) {
	var date = inputValues[i].date;
	var color = inputValues[i].color;
	var lonLatPairs = inputValues[i].lonLatPairs;
	var waypoints = lonLatPairs.slice(1, lonLatPairs.length - 1);
	if(lonLatPairs.length === 1){
		addMarker("llPass", lonLatPairs[0].lat, lonLatPairs[0].lon, 1, color);
	}else{

	// ì‹œì‘
	addMarker("llStart", lonLatPairs[0].lat, lonLatPairs[0].lon, 1, color);
	// ë„ì°©
	addMarker("llEnd", lonLatPairs[lonLatPairs.length - 1].lat, lonLatPairs[lonLatPairs.length - 1].lon, 2, color);

	// ê²½ìœ ì§€ ì‹¬ë³¼ ì°ê¸°
	for (var j = 0; j < waypoints.length; j++) {
		var waypoint = waypoints[j];
		addMarker("llPass", waypoint.lat, waypoint.lon, j + 3, color);
	}
	// 4. ê²½ë¡œíƒìƒ‰ API ì‚¬ìš©ìš”ì²­
	}
	var startX = lonLatPairs[0].lat;
	var startY = lonLatPairs[0].lon;
	var endX = lonLatPairs[lonLatPairs.length - 1].lat;
	var endY = lonLatPairs[lonLatPairs.length - 1].lon;
	var passList = waypoints.map(function(waypoint) {
		  return waypoint.lat + ',' + waypoint.lon;
		}).join('_');
	var prtcl;
	var headers = {};
	
	headers["appKey"]="L9YT0x6My9adXfumw1zGi2Gs24KLX3qS7depPI37";
	$.ajax({
			method:"POST", 
			headers : headers, 
			url:"https://apis.openapi.sk.com/tmap/routes?version=1&format=json",//
			async:false,
			data:{ 
				startX : startX,
				startY : startY,
				endX : endX,
				endY : endY,
				passList : passList,
				reqCoordType : "WGS84GEO",
				resCoordType : "WGS84GEO",
				angle : "172",
				searchOption : "0",
				trafficInfo : "N"
			},
			success:function(response){
			prtcl = response;
			
			// 5. ê²½ë¡œíƒìƒ‰ ê²°ê³¼ Line ê·¸ë¦¬ê¸° 
			var trafficColors = {
				extractStyles:true,
				/* ì‹¤ì œ êµí†µì •ë³´ê°€ í‘œì¶œë˜ë©´ ì•„ë˜ì™€ ê°™ì€ Colorë¡œ Lineì´ ìƒì„±ë©ë‹ˆë‹¤. */
				trafficDefaultColor:"#636f63", //Default
				trafficType1Color:"#19b95f", //ì›í• 
				trafficType2Color:"#f15426", //ì§€ì²´
				trafficType3Color:"#ff970e"  //ì •ì²´		
			};    			
			var style_red = {
				fillColor:"#FF0000",
				fillOpacity:0.2,
				strokeColor: "#FF0000",
				strokeWidth: 3,
				strokeDashstyle: "solid",
				pointRadius: 2,
				title: "this is a red line"
			};
			drawData(prtcl, color);
		
		
 			// 6. ê²½ë¡œíƒìƒ‰ ê²°ê³¼ ë°˜ê²½ë§Œí¼ ì§€ë„ ë ˆë²¨ ì¡°ì •
			  var center = new Tmapv2.LatLng(33.3616666, 126.5291666);
			  var zoom = 10; // í˜„ì¬ ì¤Œ ë ˆë²¨ ê°€ì ¸ì˜¤ê¸°
			  map2.setCenter(center);
			  map2.setZoom(zoom);
			},
			error:function(request,status,error){
			console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
		}
	});
	}
}
	function addMarker(status, lon, lat, tag, color) {
	//ì¶œë„ì°©ê²½ìœ êµ¬ë¶„
	//ì´ë¯¸ì§€ íŒŒì¼ ë³€ê²½.
	console.log("addMarker : "+color);
	var markerLayer;
	switch (status) {
		case "llStart":
			img = '/resources/image/marker/'+color+'start.png';
			break;
		case "llPass":
			img = '/resources/image/marker/'+color+'pass.png';
			break;
		case "llEnd":
			img = '/resources/image/marker/'+color+'end.png';
			break;
		default:
	};
	var marker = new Tmapv2.Marker({
		position: new Tmapv2.LatLng(lat,lon),
		icon: img,
		map: map2
	});
	// ë§ˆì»¤ ë“œë˜ê·¸ ì„¤ì •
	marker.tag = tag;
	marker.addListener("dragend", function (evt) {
	markerListenerEvent(evt);
    });
    marker.addListener("drag", function (evt) {    	
    	markerObject = markerList[tag];
    });
    markerList[tag] = marker;
    markers2.push(marker);
    return marker;
}
	
	 function drawRoute(date, lonLatPairs, color) {
			var waypoints = lonLatPairs.slice(1, lonLatPairs.length - 1);
			if(lonLatPairs.length === 1){
				addMarker("llPass", lonLatPairs[0].lat, lonLatPairs[0].lon, 1, color);
				
				// 4. ê²½ë¡œíƒìƒ‰ API ì‚¬ìš©ìš”ì²­
			      var startX = lonLatPairs[0].lat;
			      var startY = lonLatPairs[0].lon;
			      var endX = lonLatPairs[lonLatPairs.length - 1].lat;
			      var endY = lonLatPairs[lonLatPairs.length - 1].lon;
			      var passList = waypoints.map(function(waypoint) {
			        return waypoint.lat + ',' + waypoint.lon;
			      }).join('_');
			      var prtcl;
			  	  var headers = {};
			      
			      headers["appKey"]="L9YT0x6My9adXfumw1zGi2Gs24KLX3qS7depPI37";
			      // ê²½ë¡œ íƒìƒ‰ API í˜¸ì¶œ
					$.ajax({
						method:"POST", 
						headers : headers, 
						url:"https://apis.openapi.sk.com/tmap/routes?version=1&format=json",//
						async:false,
						data:{ 
							startX : startX,
							startY : startY,
							endX : endX,
							endY : endY,
							passList : passList,
							reqCoordType : "WGS84GEO",
							resCoordType : "WGS84GEO",
							angle : "172",
							searchOption : "0",
							trafficInfo : "N"
						},
						success:function(response){
						prtcl = response;
						
						// 5. ê²½ë¡œíƒìƒ‰ ê²°ê³¼ Line ê·¸ë¦¬ê¸° 
						var trafficColors = {
							extractStyles:true,
							/* ì‹¤ì œ êµí†µì •ë³´ê°€ í‘œì¶œë˜ë©´ ì•„ë˜ì™€ ê°™ì€ Colorë¡œ Lineì´ ìƒì„±ë©ë‹ˆë‹¤. */
							trafficDefaultColor:"#636f63", //Default
							trafficType1Color:"#19b95f", //ì›í• 
							trafficType2Color:"#f15426", //ì§€ì²´
							trafficType3Color:"#ff970e"  //ì •ì²´		
						};    			
						var style_red = {
							fillColor:"#FF0000",
							fillOpacity:0.2,
							strokeColor: "#FF0000",
							strokeWidth: 3,
							strokeDashstyle: "solid",
							pointRadius: 2,
							title: "this is a red line"
						};
						drawData(prtcl, color);
					
					
						// 6. ê²½ë¡œíƒìƒ‰ ê²°ê³¼ ë°˜ê²½ë§Œí¼ ì§€ë„ ë ˆë²¨ ì¡°ì •
						  var center = new Tmapv2.LatLng(lonLatPairs[0].lon, lonLatPairs[0].lat);
						  var zoom = 16; // í˜„ì¬ ì¤Œ ë ˆë²¨ ê°€ì ¸ì˜¤ê¸°
						  map2.setCenter(center);
						  map2.setZoom(zoom);
						},
						error:function(request,status,error){
						console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
					}
				});
				
			}else{

			// ì‹œì‘
			addMarker("llStart", lonLatPairs[0].lat, lonLatPairs[0].lon, 1, color);
			// ë„ì°©
			addMarker("llEnd", lonLatPairs[lonLatPairs.length - 1].lat, lonLatPairs[lonLatPairs.length - 1].lon, 2, color);

			// ê²½ìœ ì§€ ì‹¬ë³¼ ì°ê¸°
			for (var j = 0; j < waypoints.length; j++) {
				var waypoint = waypoints[j];
				addMarker("llPass", waypoint.lat, waypoint.lon, j + 3, color);
			}
			// 4. ê²½ë¡œíƒìƒ‰ API ì‚¬ìš©ìš”ì²­
	      var startX = lonLatPairs[0].lat;
	      var startY = lonLatPairs[0].lon;
	      var endX = lonLatPairs[lonLatPairs.length - 1].lat;
	      var endY = lonLatPairs[lonLatPairs.length - 1].lon;
	      var passList = waypoints.map(function(waypoint) {
	        return waypoint.lat + ',' + waypoint.lon;
	      }).join('_');
	      var prtcl;
	  	  var headers = {};
	      
	      headers["appKey"]="L9YT0x6My9adXfumw1zGi2Gs24KLX3qS7depPI37";
	      // ê²½ë¡œ íƒìƒ‰ API í˜¸ì¶œ
			$.ajax({
				method:"POST", 
				headers : headers, 
				url:"https://apis.openapi.sk.com/tmap/routes?version=1&format=json",//
				async:false,
				data:{ 
					startX : startX,
					startY : startY,
					endX : endX,
					endY : endY,
					passList : passList,
					reqCoordType : "WGS84GEO",
					resCoordType : "WGS84GEO",
					angle : "172",
					searchOption : "0",
					trafficInfo : "N"
				},
				success:function(response){
				prtcl = response;
				
				// 5. ê²½ë¡œíƒìƒ‰ ê²°ê³¼ Line ê·¸ë¦¬ê¸° 
				var trafficColors = {
					extractStyles:true,
					/* ì‹¤ì œ êµí†µì •ë³´ê°€ í‘œì¶œë˜ë©´ ì•„ë˜ì™€ ê°™ì€ Colorë¡œ Lineì´ ìƒì„±ë©ë‹ˆë‹¤. */
					trafficDefaultColor:"#636f63", //Default
					trafficType1Color:"#19b95f", //ì›í• 
					trafficType2Color:"#f15426", //ì§€ì²´
					trafficType3Color:"#ff970e"  //ì •ì²´		
				};    			
				var style_red = {
					fillColor:"#FF0000",
					fillOpacity:0.2,
					strokeColor: "#FF0000",
					strokeWidth: 3,
					strokeDashstyle: "solid",
					pointRadius: 2,
					title: "this is a red line"
				};
				drawData(prtcl, color);
			
			
				// 6. ê²½ë¡œíƒìƒ‰ ê²°ê³¼ ë°˜ê²½ë§Œí¼ ì§€ë„ ë ˆë²¨ ì¡°ì •
				var newData = geoData[0];
				PTbounds = new Tmapv2.LatLngBounds();
						for (var i = 0; i < newData.length; i++) {
							var mData = newData[i];
							var type = mData.geometry.type;
							var pointType = mData.properties.pointType;
							if(type == "Point"){
								var linePt = new Tmapv2.LatLng(mData.geometry.coordinates[1],mData.geometry.coordinates[0]);
								PTbounds.extend(linePt);
							}
							else{
								var startPt,endPt;
								for (var j = 0; j < mData.geometry.coordinates.length; j++) {
									var linePt = new Tmapv2.LatLng(mData.geometry.coordinates[j][1],mData.geometry.coordinates[j][0]);
									PTbounds.extend(linePt);
								}
						}
					}
						map2.fitBounds(PTbounds);
			
				},
				error:function(request,status,error){
				console.log("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
			}
		});
			}
	    }
</script>
</html>